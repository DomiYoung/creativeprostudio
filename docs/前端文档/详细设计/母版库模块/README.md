# 母版库模块

母版模板系统是CreativePro Studio批量处理的核心，允许设计一次模板，应用到所有子项目，同时支持灵活的继承和覆盖机制。

## 模块概述

母版库模块提供以下核心能力：
- 创建和管理主模板，控制公共元素
- 应用模板到批量项目，建立继承关系
- 管理元素继承属性，控制哪些元素可被子项目覆盖
- 支持模板全局更新，自动同步到所有子项目
- 支持多级模板继承，构建模板层级关系

## 主要功能

### [模板创建与管理](模板创建与管理.md)
- 主模板设计工作流
- 模板组织与分类
- 模板版本管理
- 多级模板支持

### [元素继承机制](元素继承机制.md)
- 元素继承属性控制
- 局部覆盖机制
- 继承冲突解决
- 继承状态可视化

### [模板更新机制](模板更新机制.md)
- 全局模板更新
- 选择性更新
- 更新冲突检测
- 变更预览与比较

## 界面设计

### 布局结构
- 顶部：模板信息、主要操作按钮
- 左侧：模板分类、筛选区域
- 中央：模板预览网格或编辑区
- 右侧：继承设置、属性控制面板

### 核心组件
- **模板卡片** - 预览缩略图、使用情况、版本信息
- **继承控制面板** - 管理元素继承属性
- **模板编辑器** - 与画布系统集成的模板编辑界面
- **批量应用对话框** - 将模板应用到多个项目
- **更新预览工具** - 比较更新前后的差异

## 数据结构

```javascript
// 模板数据结构
{
  id: "模板唯一ID",
  name: "模板名称",
  description: "模板描述",
  version: "1.0.0",
  category: "模板分类",
  dimensions: { width: 800, height: 800 },
  elements: [
    {
      id: "元素ID",
      type: "image|text|shape",
      properties: {
        // 元素属性
        position: { x: 100, y: 100 },
        size: { width: 200, height: 200 },
        // ...其他属性
      },
      inheritanceType: "strict|flexible|none",
      // strict - 子项目不可修改
      // flexible - 子项目可修改，但会收到更新
      // none - 完全由子项目控制，不受模板更新影响
    }
    // ...更多元素
  ],
  appliedTo: ["项目ID1", "项目ID2"],
  parentTemplate: "父模板ID",
  metadata: {
    createdAt: "2025-01-01T12:00:00Z",
    updatedAt: "2025-01-02T14:30:00Z",
    createdBy: "创建者ID",
    usageCount: 42
  }
}
```

## 继承规则

1. **继承类型**
   - **严格继承(strict)** - 子项目不可修改，模板更新强制应用
   - **灵活继承(flexible)** - 子项目可修改，模板更新时保留修改
   - **不继承(none)** - 仅作为初始值，后续不受模板影响

2. **继承属性**
   - 位置(position)
   - 大小(size)
   - 内容(content)
   - 样式(style)
   - 可见性(visibility)

## 交互流程

1. **模板创建流程**
   - 创建新模板（从头开始或基于现有模板）
   - 设计模板内容（添加元素、设置样式等）
   - 为每个元素设置继承属性
   - 保存模板并设置分类

2. **模板应用流程**
   - 选择要应用的模板
   - 选择目标项目（单个或批量）
   - 设置应用选项（如覆盖规则）
   - 确认应用，建立继承关系

3. **模板更新流程**
   - 修改模板内容
   - 预览变更影响
   - 选择更新范围（所有或部分子项目）
   - 确认更新，同步到子项目

## 与其他模块交互

- **素材库模块** - 提供模板设计所需素材
- **画布系统** - 为模板编辑提供画布支持
- **批量处理模块** - 应用模板到批量项目
- **图层管理** - 控制模板中图层的继承属性

## 技术实现

- 使用深度比较算法检测模板变更
- 采用原型继承模式实现属性继承
- 实现高效增量更新机制
- 提供冲突解决策略和合并算法

[返回详细设计](../README.md) | [返回前端文档](../../README.md) | [返回文档中心](../../../README.md) 