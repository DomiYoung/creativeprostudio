<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assets Library - CreativePro Studio</title>
    <link rel="stylesheet" href="../styles/kimtrue-brand.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../styles/asset-library.css">
</head>
<body>
    <div class="app-container">
        <!-- 顶部导航栏 -->
        <header class="app-header">
            <div class="header-logo">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAxMDAgMzIiPjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMzIiIGZpbGw9IiNGNUUxRDkiIHJ4PSI0Ij48L3JlY3Q+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0cHgiIGZvbnQtd2VpZ2h0PSI2MDAiIGZpbGw9IiM0QTRBNEEiPkNyZWF0aXZlUHJvPC90ZXh0Pjwvc3ZnPg==" alt="CreativePro Studio">
                <span>CreativePro Studio</span>
            </div>
            <nav class="header-nav">
                <a href="#" class="nav-link active">素材库</a>
                <a href="#" class="nav-link">设计项目</a>
                <a href="#" class="nav-link">团队协作</a>
                <a href="#" class="nav-link">数据分析</a>
            </nav>
            <div class="header-actions">
                <button class="action-btn"><i class="fas fa-bell"></i></button>
                <button class="action-btn"><i class="fas fa-cog"></i></button>
                <div class="user-profile">
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzNiIgaGVpZ2h0PSIzNiIgdmlld0JveD0iMCAwIDM2IDM2Ij48Y2lyY2xlIGN4PSIxOCIgY3k9IjE4IiByPSIxOCIgZmlsbD0iI0U4RDVDOCIvPjx0ZXh0IHg9IjE4IiB5PSIxOCIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTRweCIgZm9udC13ZWlnaHQ9IjUwMCIgZmlsbD0iIzRBNEE0QSI+VTwvdGV4dD48L3N2Zz4=" alt="用户头像">
                </div>
            </div>
        </header>

        <!-- 主要内容区域 -->
        <div class="page-container">
            <!-- 侧边栏 -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">素材资源</div>
                    <div class="sidebar-item">
                        <a href="#" class="sidebar-link active" data-type="all">
                            <i class="fas fa-th-large"></i>
                            全部素材
                        </a>
                    </div>
                    <div class="sidebar-item">
                        <a href="#" class="sidebar-link" data-type="recent">
                            <i class="fas fa-clock"></i>
                            最近使用
                        </a>
                    </div>
                    <div class="sidebar-item">
                        <a href="#" class="sidebar-link" data-type="favorites">
                            <i class="fas fa-star"></i>
                            收藏夹
                        </a>
                    </div>
                    <div class="sidebar-item">
                        <a href="#" class="sidebar-link" data-type="trash">
                            <i class="fas fa-trash"></i>
                            回收站
                        </a>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">文件夹</div>
                    <div class="sidebar-item folder-item" data-folder-id="folder1">
                        <a href="#" class="sidebar-link" data-type="folder">
                            <i class="fas fa-folder"></i>
                            活动素材
                        </a>
                    </div>
                    <div class="sidebar-item folder-item" data-folder-id="folder2">
                        <a href="#" class="sidebar-link" data-type="folder">
                            <i class="fas fa-folder"></i>
                            新品发布
                        </a>
                    </div>
                    <div class="sidebar-item folder-item" data-folder-id="folder3">
                        <a href="#" class="sidebar-link" data-type="folder">
                            <i class="fas fa-folder"></i>
                            海报素材
                        </a>
                    </div>
                    <div class="sidebar-item">
                        <a href="#" class="sidebar-link add-folder">
                            <i class="fas fa-plus"></i>
                            新建文件夹
                        </a>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">品牌资源</div>
                    <div class="sidebar-item">
                        <a href="#" class="sidebar-link" data-type="brand" data-brand="anxiuze">
                            <i class="fas fa-bookmark"></i>
                            安修泽
                        </a>
                    </div>
                    <div class="sidebar-item">
                        <a href="#" class="sidebar-link" data-type="brand" data-brand="qichu">
                            <i class="fas fa-bookmark"></i>
                            且初
                        </a>
                    </div>
                    <div class="sidebar-item">
                        <a href="#" class="sidebar-link" data-type="brand" data-brand="ddg">
                            <i class="fas fa-bookmark"></i>
                            ddg
                        </a>
                    </div>
                </div>
            </aside>
            
            <!-- 主内容区 -->
            <main class="materials-content">
                <div class="content-area active">
                    <!-- 内容头部 -->
                    <div class="materials-header">
                        <div>
                            <h1 class="materials-title">素材库</h1>
                            <p class="materials-subtitle">管理和组织您的设计素材</p>
                        </div>
                        <div class="materials-actions">
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="搜索素材...">
                            </div>
                            <button class="btn btn-outline" id="advanced-filter-btn">
                                <i class="fas fa-filter"></i> 筛选
                            </button>
                            <button class="btn btn-outline" title="加入文件夹">
                                <i class="fas fa-folder-plus"></i>
                            </button>
                            <button class="btn btn-primary upload-btn" id="upload-btn">
                                <i class="fas fa-plus"></i> 上传素材
                            </button>
                            <button class="btn btn-light" id="view-toggle-btn" title="切换视图">
                                <i class="fas fa-th-large"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- 活跃筛选器 -->
                    <div class="active-filters" id="active-filters" style="display: none;">
                        <div>
                            <span>筛选条件：</span>
                            <div class="active-filter-chips"></div>
                        </div>
                        <button class="clear-filters-btn">清除全部</button>
                    </div>
                    
                    <!-- 分类标签 -->
                    <div class="category-tabs">
                        <button class="category-tab active">全部</button>
                        <button class="category-tab">图片</button>
                        <button class="category-tab">图标</button>
                        <button class="category-tab">图形</button>
                        <button class="category-tab">视频</button>
                        <button class="category-tab">文档</button>
                    </div>
                    
                    <!-- 标签筛选器 -->
                    <div class="tag-filters">
                        <span class="tag-filter active">全部标签</span>
                        <span class="tag-filter">产品</span>
                        <span class="tag-filter">营销</span>
                        <span class="tag-filter">节日</span>
                        <span class="tag-filter">社交</span>
                        <span class="tag-filter">简约</span>
                        <span class="tag-filter">高级感</span>
                        <span class="tag-filter">自然</span>
                        <span class="tag-filter">商务</span>
                        <span class="tag-filter">+</span>
                    </div>
                    
                    <!-- 批量操作栏 -->
                    <div class="bulk-actions" style="display: none;">
                        <div>已选择 <span id="selected-count">0</span> 个素材</div>
                        <div class="bulk-action-buttons">
                            <button class="btn btn-primary">下载所选</button>
                            <button class="btn btn-outline">移动到</button>
                            <button class="btn btn-outline">删除</button>
                            <button class="btn btn-light cancel-selection">取消</button>
                        </div>
                    </div>
                    
                    <!-- 素材网格 -->
                    <div class="materials-grid">
                        <!-- 素材卡片将通过JavaScript添加 -->
                    </div>
                    
                    <!-- 分页 -->
                    <div class="pagination">
                        <button class="pagination-button" disabled><i class="fas fa-chevron-left"></i></button>
                        <button class="pagination-button active">1</button>
                        <button class="pagination-button">2</button>
                        <button class="pagination-button">3</button>
                        <span class="pagination-ellipsis">...</span>
                        <button class="pagination-button">10</button>
                        <button class="pagination-button"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- JavaScript脚本 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 添加示例素材数据
            const materialsData = [
                {
                    id: 'card1',
                    title: '安修泽产品展示图',
                    type: '图片',
                    brand: '安修泽',
                    size: '1200 x 1000px',
                    date: '2023-06-15',
                    image: 'https://images.pexels.com/photos/3373736/pexels-photo-3373736.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260'
                },
                {
                    id: 'card2',
                    title: '安修泽品牌Logo',
                    type: 'Logo',
                    brand: '安修泽',
                    size: '500 x 500px',
                    date: '2023-05-10',
                    image: 'https://images.pexels.com/photos/3373723/pexels-photo-3373723.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260'
                },
                {
                    id: 'card3',
                    title: '产品展示图',
                    type: '图片',
                    size: '1200 x 800px',
                    date: '2023-06-10',
                    image: 'https://images.pexels.com/photos/5632402/pexels-photo-5632402.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260'
                },
                {
                    id: 'card4',
                    title: '渐变背景',
                    type: '背景',
                    size: '1920 x 1080px',
                    date: '2023-05-25',
                    image: 'https://images.pexels.com/photos/5632398/pexels-photo-5632398.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260'
                },
                {
                    id: 'card5',
                    title: '社交媒体图标集',
                    type: '图标',
                    size: '64 x 64px',
                    date: '2023-04-18',
                    image: 'https://images.pexels.com/photos/5632387/pexels-photo-5632387.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260'
                },
                {
                    id: 'card6',
                    title: '几何图形集',
                    type: '图形',
                    size: '800 x 800px',
                    date: '2023-06-05',
                    image: 'https://images.pexels.com/photos/5632385/pexels-photo-5632385.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260'
                }
            ];
            
            // 将素材数据添加到网格
            const materialsGrid = document.querySelector('.materials-grid');
            
            // 清空网格（如果有初始内容）
            materialsGrid.innerHTML = '';
            
            // 添加素材卡片
            materialsData.forEach(material => {
                const materialCard = createMaterialCard(material);
                materialsGrid.appendChild(materialCard);
            });
            
            // 添加"添加新素材"卡片
            const createNewMaterial = document.createElement('div');
            createNewMaterial.className = 'material-card create-new-material';
            createNewMaterial.id = 'create-new-material';
            createNewMaterial.innerHTML = `
                <div class="create-new-content">
                    <i class="fas fa-plus"></i>
                    <p>添加新素材</p>
                </div>
            `;
            materialsGrid.appendChild(createNewMaterial);
            
            // 侧边栏导航切换
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 防止重复点击
                    if (this.classList.contains('active')) {
                        return;
                    }
                    
                    // 添加点击反馈效果
                    this.classList.add('clicked');
                    setTimeout(() => {
                        this.classList.remove('clicked');
                    }, 300);
                    
                    // 移除所有链接的激活状态
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    // 激活当前链接
                    this.classList.add('active');
                    
                    // 显示对应的内容区域
                    const type = this.getAttribute('data-type');
                    
                    // 更新页面标题
                    updateContentHeader(this.textContent.trim());
                    
                    // 根据类型处理不同的内容
                    if (type === 'folder') {
                        const folderId = this.closest('.folder-item').getAttribute('data-folder-id');
                        showFolderContents(folderId);
                    } else if (type === 'brand') {
                        const brand = this.getAttribute('data-brand');
                        filterByBrand(brand);
                    } else if (type === 'all') {
                        showAllMaterials();
                    } else if (type === 'recent') {
                        // 模拟最近使用的素材，实际应该从API获取
                        filterByIds(['card1', 'card3']);
                        showNotification('显示最近使用的素材');
                    } else if (type === 'favorites') {
                        // 模拟收藏夹，实际应该从API获取
                        filterByIds(['card2', 'card5']);
                        showNotification('显示收藏的素材');
                    } else if (type === 'trash') {
                        // 模拟回收站，实际应该从API获取
                        showEmptyState('回收站是空的');
                    } else if (type === 'add-folder') {
                        showNotification('新建文件夹功能即将上线');
                    }
                });
            });
            
            // 显示空状态
            function showEmptyState(message) {
                // 清空素材网格
                materialsGrid.innerHTML = '';
                
                // 创建空状态消息
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-folder-message';
                emptyState.innerHTML = `
                    <i class="fas fa-folder-open"></i>
                    <p>${message}</p>
                `;
                
                // 添加到网格
                materialsGrid.appendChild(emptyState);
            }
            
            // 按ID筛选素材
            function filterByIds(ids) {
                const materialCards = document.querySelectorAll('.material-card:not(#create-new-material)');
                
                materialCards.forEach(card => {
                    const cardId = card.getAttribute('data-card-id');
                    
                    if (ids.includes(cardId)) {
                        card.style.display = '';
                        
                        // 添加平滑出现动画
                        card.style.animation = 'none';
                        void card.offsetWidth; // 触发重绘
                        card.style.animation = 'fadeIn 0.3s ease-out';
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                // 确保创建新素材卡片总是可见
                const createNewCard = document.getElementById('create-new-material');
                if (createNewCard) {
                    createNewCard.style.display = '';
                }
                
                // 如果没有素材，显示空状态
                if (ids.length === 0) {
                    showEmptyState('没有符合条件的素材');
                }
            }
            
            // 文件夹内容显示函数优化
            function showFolderContents(folderId) {
                // 模拟数据，实际应该从API获取
                const folderContents = {
                    'folder1': ['card1', 'card2'],
                    'folder2': ['card3'],
                    'folder3': ['card2', 'card3', 'card5']
                };
                
                // 显示加载指示器
                showNotification('正在加载文件夹内容...');
                
                // 模拟网络延迟
                setTimeout(() => {
                    // 检查文件夹是否有内容
                    if (folderContents[folderId] && folderContents[folderId].length > 0) {
                        // 筛选显示文件夹内的素材
                        filterByIds(folderContents[folderId]);
                    } else {
                        // 显示空文件夹状态
                        showEmptyState('此文件夹为空');
                    }
                }, 300);
            }
            
            // 更新内容标题
            function updateContentHeader(title) {
                const materialsTitle = document.querySelector('.materials-title');
                const materialsSubtitle = document.querySelector('.materials-subtitle');
                
                if (materialsTitle) {
                    materialsTitle.textContent = title;
                }
                
                if (materialsSubtitle) {
                    // 根据标题设置副标题
                    if (title.includes('文件夹')) {
                        materialsSubtitle.textContent = '文件夹中的素材资源';
                    } else if (title === '全部素材') {
                        materialsSubtitle.textContent = '管理和组织您的设计素材';
                    } else if (title === '最近使用') {
                        materialsSubtitle.textContent = '最近使用的素材内容';
                    } else if (title === '收藏夹') {
                        materialsSubtitle.textContent = '您收藏的素材内容';
                    } else if (title === '回收站') {
                        materialsSubtitle.textContent = '已删除的素材内容';
                    } else {
                        materialsSubtitle.textContent = `${title}品牌的素材资源`;
                    }
                }
            }
            
            // 显示所有素材
            function showAllMaterials() {
                const materialCards = document.querySelectorAll('.material-card:not(#create-new-material)');
                
                materialCards.forEach(card => {
                    card.style.display = '';
                    
                    // 添加平滑出现动画
                    card.style.animation = 'none';
                    void card.offsetWidth; // 触发重绘
                    card.style.animation = 'fadeIn 0.3s ease-out';
                });
            }
            
            // 按品牌筛选
            function filterByBrand(brand) {
                const materialCards = document.querySelectorAll('.material-card:not(#create-new-material)');
                
                materialCards.forEach(card => {
                    const brandTag = card.querySelector('.brand-tag');
                    
                    if (brandTag && brandTag.textContent.trim().toLowerCase() === brand) {
                        card.style.display = '';
                        
                        // 添加平滑出现动画
                        card.style.animation = 'none';
                        void card.offsetWidth; // 触发重绘
                        card.style.animation = 'fadeIn 0.3s ease-out';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }
            
            // 显示通知提示
            function showNotification(message) {
                // 检查通知组件是否已存在
                let notification = document.getElementById('notification');
                
                if (!notification) {
                    notification = document.createElement('div');
                    notification.id = 'notification';
                    notification.className = 'notification';
                    document.body.appendChild(notification);
                }
                
                // 清除任何现有的超时
                if (window.notificationTimeout) {
                    clearTimeout(window.notificationTimeout);
                }
                
                // 设置通知内容
                notification.textContent = message;
                
                // 如果通知已经处于活动状态，先移除再添加，以触发动画重置
                if (notification.classList.contains('active')) {
                    notification.classList.remove('active');
                    // 强制布局重新计算
                    void notification.offsetHeight;
                }
                
                // 添加活动类
                notification.classList.add('active');
                
                // 自动关闭并存储超时引用
                window.notificationTimeout = setTimeout(() => {
                    notification.classList.remove('active');
                }, 3000);
            }
            
            // 添加事件委托处理程序，优化卡片交互
            materialsGrid.addEventListener('click', function(e) {
                // 处理卡片点击事件
                const materialCard = e.target.closest('.material-card');
                if (materialCard && materialCard.id !== 'create-new-material') {
                    // 处理常规卡片点击
                    const actionBtn = e.target.closest('.action-btn');
                    
                    if (actionBtn) {
                        // 获取操作类型
                        const actionType = actionBtn.getAttribute('title');
                        
                        if (actionType === '下载') {
                            e.preventDefault(); // 防止导航
                            showNotification('开始下载素材');
                        } else if (actionType === '编辑') {
                            e.preventDefault();
                            showNotification('正在打开编辑器');
                        } else if (actionType === '更多操作') {
                            e.preventDefault();
                            showNotification('显示更多操作选项');
                        }
                    }
                } else if (materialCard && materialCard.id === 'create-new-material') {
                    // 处理"添加新素材"卡片点击
                    e.preventDefault();
                    showNotification('准备添加新素材');
                    // 这里可以触发上传对话框
                    document.getElementById('upload-btn').click();
                }
            });
            
            // 修复搜索栏
            const searchInput = document.querySelector('.search-bar input');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase().trim();
                    
                    // 如果搜索词为空，显示所有素材
                    if (searchTerm === '') {
                        showAllMaterials();
                        return;
                    }
                    
                    // 过滤素材
                    const materialCards = document.querySelectorAll('.material-card:not(#create-new-material)');
                    let hasResults = false;
                    
                    materialCards.forEach(card => {
                        const title = card.querySelector('.material-title').textContent.toLowerCase();
                        const type = card.querySelector('.material-type').textContent.toLowerCase();
                        const brandTag = card.querySelector('.brand-tag');
                        const brand = brandTag ? brandTag.textContent.toLowerCase() : '';
                        
                        if (title.includes(searchTerm) || type.includes(searchTerm) || brand.includes(searchTerm)) {
                            card.style.display = '';
                            hasResults = true;
                            
                            // 添加平滑出现动画
                            card.style.animation = 'none';
                            void card.offsetWidth; // 触发重绘
                            card.style.animation = 'fadeIn 0.3s ease-out';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                    
                    // 如果没有结果，显示提示
                    if (!hasResults) {
                        if (!document.querySelector('.no-results-message')) {
                            const noResultsMessage = document.createElement('div');
                            noResultsMessage.className = 'no-results-message';
                            noResultsMessage.innerHTML = `
                                <div class="empty-folder-message">
                                    <i class="fas fa-search"></i>
                                    <p>没有找到匹配"${searchTerm}"的素材</p>
                                </div>
                            `;
                            materialsGrid.appendChild(noResultsMessage);
                        }
                    } else {
                        // 移除无结果提示
                        const noResultsMessage = document.querySelector('.no-results-message');
                        if (noResultsMessage) {
                            noResultsMessage.remove();
                        }
                    }
                });
            }
            
            // 防止快速操作按钮多次点击导致的异常
            const actionButtons = document.querySelectorAll('.action-btn');
            actionButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    // 防止事件冒泡，避免触发卡片点击
                    e.stopPropagation();
                    
                    // 如果按钮已被禁用，不执行操作
                    if (this.disabled) return;
                    
                    // 临时禁用按钮，防止重复点击
                    this.disabled = true;
                    
                    // 300ms后重新启用按钮
                    setTimeout(() => {
                        this.disabled = false;
                    }, 300);
                });
            });
            
            // 优化触摸设备上的交互
            if ('ontouchstart' in window) {
                document.body.classList.add('touch-device');
                
                // 为移动设备优化卡片点击区域
                const materialCards = document.querySelectorAll('.material-card');
                materialCards.forEach(card => {
                    card.addEventListener('touchstart', function() {
                        this.classList.add('touch-active');
                    });
                    
                    card.addEventListener('touchend', function() {
                        this.classList.remove('touch-active');
                    });
                    
                    card.addEventListener('touchcancel', function() {
                        this.classList.remove('touch-active');
                    });
                });
            }
            
            // 分类标签切换
            const categoryTabs = document.querySelectorAll('.category-tab');
            
            categoryTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // 防止重复点击已激活的标签
                    if (this.classList.contains('active')) {
                        return;
                    }
                    
                    // 添加点击反馈效果
                    this.classList.add('clicked');
                    setTimeout(() => {
                        this.classList.remove('clicked');
                    }, 300);
                    
                    // 添加波纹效果
                    createRippleEffect(this);
                    
                    // 移除所有标签的激活状态
                    categoryTabs.forEach(t => t.classList.remove('active'));
                    // 激活当前标签
                    this.classList.add('active');
                    
                    // 筛选对应的素材
                    const category = this.textContent.trim();
                    if (category === '全部') {
                        showAllMaterials();
                    } else {
                        filterByType(category);
                    }
                });
            });
            
            // 标签筛选器切换
            const tagFilters = document.querySelectorAll('.tag-filter');
            
            tagFilters.forEach(filter => {
                filter.addEventListener('click', function() {
                    // 添加点击反馈效果
                    this.classList.add('clicked');
                    setTimeout(() => {
                        this.classList.remove('clicked');
                    }, 300);
                    
                    // 添加波纹效果
                    createRippleEffect(this);
                    
                    // 处理筛选逻辑
                    if (this.textContent.includes('全部标签')) {
                        tagFilters.forEach(f => {
                            if (!f.textContent.includes('全部标签')) {
                                f.classList.remove('active');
                            }
                        });
                        this.classList.add('active');
                        // 显示所有素材
                        showAllMaterials();
                    } else {
                        // 取消"全部标签"的激活状态
                        tagFilters.forEach(f => {
                            if (f.textContent.includes('全部标签')) {
                                f.classList.remove('active');
                            }
                        });
                        
                        // 切换当前标签的激活状态
                        this.classList.toggle('active');
                        
                        // 如果没有激活的标签，则激活"全部标签"并显示所有素材
                        const activeFilters = document.querySelectorAll('.tag-filter.active');
                        if (activeFilters.length === 0) {
                            tagFilters.forEach(f => {
                                if (f.textContent.includes('全部标签')) {
                                    f.classList.add('active');
                                }
                            });
                            showAllMaterials();
                        } else {
                            // 应用标签筛选
                            // 这里简化实现，实际应该根据选中的标签进行更复杂的筛选
                            filterByTag(this.textContent.trim());
                        }
                    }
                });
            });
            
            // 按标签筛选（简化实现）
            function filterByTag(tag) {
                showNotification(`按标签 "${tag}" 筛选素材`);
                // 随机显示几个素材作为示例
                const allCards = Array.from(document.querySelectorAll('.material-card:not(#create-new-material)'));
                const randomCards = allCards.sort(() => 0.5 - Math.random()).slice(0, 3);
                const randomIds = randomCards.map(card => card.getAttribute('data-card-id'));
                filterByIds(randomIds);
            }
            
            // 按类型筛选
            function filterByType(type) {
                const materialCards = document.querySelectorAll('.material-card:not(#create-new-material)');
                
                materialCards.forEach(card => {
                    const typeTag = card.querySelector('.material-type');
                    
                    if (typeTag && typeTag.textContent.trim() === type) {
                        card.style.display = '';
                        
                        // 添加平滑出现动画
                        card.style.animation = 'none';
                        void card.offsetWidth; // 触发重绘
                        card.style.animation = 'fadeIn 0.3s ease-out';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }
            
            // 视图切换
            const viewToggleBtn = document.getElementById('view-toggle-btn');
            
            if (viewToggleBtn) {
                viewToggleBtn.addEventListener('click', function() {
                    // 添加点击反馈效果
                    this.classList.add('clicked');
                    setTimeout(() => {
                        this.classList.remove('clicked');
                    }, 300);
                    
                    // 切换视图图标
                    const icon = this.querySelector('i');
                    if (icon.classList.contains('fa-th-large')) {
                        icon.classList.remove('fa-th-large');
                        icon.classList.add('fa-list');
                        showNotification('已切换到列表视图');
                    } else {
                        icon.classList.remove('fa-list');
                        icon.classList.add('fa-th-large');
                        showNotification('已切换到网格视图');
                    }
                    
                    // 处理视图样式切换
                    materialsGrid.classList.toggle('list-view');
                    
                    // 添加动画效果
                    const cards = document.querySelectorAll('.material-card');
                    cards.forEach((card, index) => {
                        // 重置动画
                        card.style.animation = 'none';
                        card.offsetHeight; // 触发重绘
                        
                        // 应用新动画，根据视图类型选择不同的动画
                        if (materialsGrid.classList.contains('list-view')) {
                            card.style.animation = `slideIn 0.3s ease-out ${index * 0.05}s forwards`;
                        } else {
                            card.style.animation = `fadeIn 0.3s ease-out ${index * 0.05}s forwards`;
                        }
                    });
                });
            }
            
            // 创建波纹效果
            function createRippleEffect(element) {
                // 检查是否支持触摸
                if (!('ontouchstart' in window)) return;
                
                const ripple = document.createElement('span');
                ripple.className = 'ripple';
                element.appendChild(ripple);
                
                const rect = element.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                
                ripple.style.width = ripple.style.height = `${size}px`;
                ripple.style.left = `${rect.width / 2 - size / 2}px`;
                ripple.style.top = `${rect.height / 2 - size / 2}px`;
                
                // 动画结束后移除
                ripple.addEventListener('animationend', () => {
                    ripple.remove();
                });
            }
            
            // 添加滚动显示动画
            function initScrollReveal() {
                const cards = document.querySelectorAll('.material-card');
                cards.forEach(card => {
                    card.classList.add('scroll-reveal');
                });
                
                // 检查哪些元素应该可见
                checkScrollReveal();
                
                // 添加滚动监听
                window.addEventListener('scroll', debounce(checkScrollReveal, 100));
            }
            
            // 防抖函数，优化性能
            function debounce(func, wait) {
                let timeout;
                return function() {
                    const context = this;
                    const args = arguments;
                    clearTimeout(timeout);
                    timeout = setTimeout(() => {
                        func.apply(context, args);
                    }, wait);
                };
            }
            
            // 创建素材卡片函数
            function createMaterialCard(material) {
                const materialCard = document.createElement('div');
                materialCard.className = 'material-card';
                materialCard.setAttribute('data-card-id', material.id);
                
                // 如果有品牌，添加品牌相关的类
                if (material.brand === '安修泽') {
                    materialCard.classList.add('kimtrue-card');
                }
                
                // 创建卡片内容
                materialCard.innerHTML = `
                    <div class="material-thumbnail">
                        <img src="${material.image}" alt="${material.title}">
                        <div class="material-tags">
                            ${material.brand ? `<span class="brand-tag">${material.brand}</span>` : ''}
                            <span class="material-type">${material.type}</span>
                        </div>
                    </div>
                    <div class="material-info">
                        <div class="material-title">${material.title}</div>
                        <div class="material-meta">
                            <span>${material.size}</span>
                            <span>${material.date}</span>
                        </div>
                    </div>
                    <div class="material-actions">
                        <button class="action-btn" title="编辑"><i class="fas fa-pencil-alt"></i></button>
                        <button class="action-btn" title="下载"><i class="fas fa-download"></i></button>
                        <button class="action-btn" title="更多操作"><i class="fas fa-ellipsis-h"></i></button>
                    </div>
                `;
                
                return materialCard;
            }
            
            // 上传按钮交互
            const uploadBtn = document.getElementById('upload-btn');
            if (uploadBtn) {
                uploadBtn.addEventListener('click', function() {
                    // 添加点击反馈效果
                    this.classList.add('clicked');
                    setTimeout(() => {
                        this.classList.remove('clicked');
                    }, 300);
                    
                    // 打开上传模态窗口
                    document.getElementById('upload-modal').classList.add('active');
                    document.body.style.overflow = 'hidden';
                    showNotification('请选择素材类型和品牌再上传');
                });
            }
            
            // 初始化上传模态窗口交互
            (function initUploadModal() {
                const modal = document.getElementById('upload-modal');
                if (!modal) return;
                
                // 关闭模态窗口
                function closeModal() {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                    // 重置表单
                    resetUploadForm();
                }
                
                // 重置表单
                function resetUploadForm() {
                    // 重置文件输入
                    document.getElementById('file-upload').value = '';
                    // 清空文件预览区域
                    document.querySelector('.preview-grid').innerHTML = '';
                    document.querySelector('.upload-preview').style.display = 'none';
                    // 重置标题和标签
                    document.getElementById('material-title').value = '';
                    document.getElementById('material-tags').value = '';
                    // 重置单选按钮
                    document.querySelectorAll('input[type="radio"]').forEach(radio => {
                        radio.checked = false;
                    });
                    // 重置上传按钮
                    document.querySelector('.confirm-upload').disabled = true;
                    // 重置进度条
                    document.querySelector('.upload-progress-container').style.display = 'none';
                    document.querySelector('.upload-progress-fill').style.width = '0%';
                }
                
                // 关闭按钮和蒙层点击
                modal.querySelector('.modal-close').addEventListener('click', closeModal);
                modal.querySelector('.cancel-upload').addEventListener('click', closeModal);
                modal.querySelector('.modal-overlay').addEventListener('click', closeModal);
                
                // 阻止内容区点击冒泡
                modal.querySelector('.modal-content').addEventListener('click', e => e.stopPropagation());
                
                // 选项卡切换
                modal.querySelectorAll('.upload-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        if (this.classList.contains('active')) return;
                        
                        // 切换标签
                        modal.querySelectorAll('.upload-tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // 切换内容
                        const tabId = this.getAttribute('data-tab');
                        modal.querySelectorAll('.upload-tab-content').forEach(content => content.classList.remove('active'));
                        document.getElementById(tabId).classList.add('active');
                    });
                });
                
                // 文件上传
                const fileInput = document.getElementById('file-upload');
                
                // 浏览文件
                modal.querySelector('.upload-browse').addEventListener('click', () => fileInput.click());
                
                // 文件选择处理
                fileInput.addEventListener('change', function() {
                    if (this.files.length === 0) return;
                    
                    // 显示预览区域
                    const previewArea = document.querySelector('.upload-preview');
                    const previewGrid = document.querySelector('.preview-grid');
                    const selectedCountElem = document.getElementById('selected-files-count');
                    
                    if (previewArea && previewGrid) {
                        previewArea.style.display = 'block';
                        previewGrid.innerHTML = ''; // 清空之前的预览
                        
                        // 更新已选择文件数量
                        if (selectedCountElem) {
                            selectedCountElem.textContent = this.files.length;
                        }
                        
                        // 生成预览
                        Array.from(this.files).forEach((file, index) => {
                            // 仅处理图片文件
                            if (!file.type.startsWith('image/')) {
                                return;
                            }
                            
                            // 创建预览项
                            const previewItem = document.createElement('div');
                            previewItem.className = 'preview-item';
                            previewItem.setAttribute('data-index', index);
                            
                            // 读取图片预览
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                previewItem.innerHTML = `
                                    <img src="${e.target.result}" alt="${file.name}">
                                    <div class="preview-item-info">${file.name}</div>
                                    <div class="preview-item-select"><i class="fas fa-check"></i></div>
                                    <button class="preview-remove" title="移除"><i class="fas fa-times"></i></button>
                                `;
                                
                                // 绑定选择事件
                                previewItem.addEventListener('click', function(e) {
                                    // 如果点击的是删除按钮则跳过
                                    if (e.target.closest('.preview-remove')) {
                                        return;
                                    }
                                    
                                    this.classList.toggle('selected');
                                    
                                    // 更新选中项数量
                                    updateSelectedFilesCount();
                                });
                                
                                // 绑定删除按钮事件
                                const removeBtn = previewItem.querySelector('.preview-remove');
                                if (removeBtn) {
                                    removeBtn.addEventListener('click', function(e) {
                                        e.stopPropagation();
                                        previewItem.remove();
                                        
                                        // 更新选中数量
                                        updateSelectedFilesCount();
                                        
                                        // 如果没有剩余项，隐藏预览区域
                                        if (document.querySelectorAll('.preview-item').length === 0) {
                                            previewArea.style.display = 'none';
                                        }
                                    });
                                }
                            };
                            reader.readAsDataURL(file);
                            
                            previewGrid.appendChild(previewItem);
                        });
                        
                        // 检查是否需要显示批量应用按钮
                        checkBatchApplyButton();
                    }
                    
                    // 文件名填入标题（如果标题为空且只选择了一个文件）
                    if (this.files.length === 1 && !document.getElementById('material-title').value) {
                        const fileName = this.files[0].name.replace(/\.[^/.]+$/, "");
                        document.getElementById('material-title').value = fileName;
                    }
                    
                    // 检查表单是否可提交
                    validateForm();
                });
                
                // 更新选中文件数量
                function updateSelectedFilesCount() {
                    const selectedItems = document.querySelectorAll('.preview-item.selected');
                    const selectedCountElem = document.getElementById('selected-files-count');
                    
                    if (selectedCountElem) {
                        selectedCountElem.textContent = document.querySelectorAll('.preview-item').length;
                    }
                    
                    // 更新批量应用按钮状态
                    checkBatchApplyButton();
                }
                
                // 检查是否显示批量应用按钮
                function checkBatchApplyButton() {
                    const batchActionBtn = document.querySelector('.batch-action[data-action="apply-all"]');
                    const previewItems = document.querySelectorAll('.preview-item');
                    
                    if (batchActionBtn) {
                        // 只有超过1个文件时才启用批量应用
                        batchActionBtn.disabled = previewItems.length <= 1;
                    }
                }
                
                // 批量应用按钮
                const batchApplyBtn = document.querySelector('.batch-action[data-action="apply-all"]');
                const batchApplyForm = document.getElementById('batch-apply-form');
                const batchCount = document.getElementById('batch-count');
                
                if (batchApplyBtn && batchApplyForm) {
                    // 点击批量应用按钮
                    batchApplyBtn.addEventListener('click', function() {
                        // 显示批量应用表单
                        batchApplyForm.style.display = 'block';
                        // 隐藏常规表单
                        document.querySelector('.material-meta-form').style.display = 'none';
                        
                        // 更新批量应用数量
                        const totalItems = document.querySelectorAll('.preview-item').length;
                        if (batchCount) {
                            batchCount.textContent = totalItems;
                        }
                        
                        showNotification('请设置要批量应用的属性');
                    });
                    
                    // 取消批量应用
                    const batchCancelBtn = document.getElementById('batch-cancel');
                    if (batchCancelBtn) {
                        batchCancelBtn.addEventListener('click', function() {
                            // 隐藏批量应用表单
                            batchApplyForm.style.display = 'none';
                            // 显示常规表单
                            document.querySelector('.material-meta-form').style.display = 'block';
                        });
                    }
                    
                    // 应用批量设置
                    const applyBatchBtn = document.getElementById('apply-batch-settings');
                    if (applyBatchBtn) {
                        applyBatchBtn.addEventListener('click', function() {
                            // 获取批量设置
                            const batchBrand = document.querySelector('input[name="batch-brand"]:checked');
                            const batchType = document.querySelector('input[name="batch-type"]:checked');
                            const batchTags = document.getElementById('batch-tags');
                            
                            // 收集设置信息
                            let settingsApplied = [];
                            
                            // 应用品牌设置
                            if (batchBrand) {
                                // 设置常规表单中对应的选项
                                const normalBrand = document.querySelector(`input[name="brand"][value="${batchBrand.value}"]`);
                                if (normalBrand) {
                                    normalBrand.checked = true;
                                }
                                settingsApplied.push(`品牌：${batchBrand.value}`);
                            }
                            
                            // 应用类型设置
                            if (batchType) {
                                // 设置常规表单中对应的选项
                                const normalType = document.querySelector(`input[name="type"][value="${batchType.value}"]`);
                                if (normalType) {
                                    normalType.checked = true;
                                }
                                settingsApplied.push(`类型：${batchType.value}`);
                            }
                            
                            // 应用标签设置
                            if (batchTags && batchTags.value.trim()) {
                                document.getElementById('material-tags').value = batchTags.value;
                                settingsApplied.push('标签');
                            }
                            
                            // 隐藏批量应用表单
                            batchApplyForm.style.display = 'none';
                            // 显示常规表单
                            document.querySelector('.material-meta-form').style.display = 'block';
                            
                            // 显示应用成功消息
                            if (settingsApplied.length > 0) {
                                showNotification(`已批量应用设置：${settingsApplied.join('、')}`);
                            } else {
                                showNotification('未选择任何设置进行批量应用');
                            }
                            
                            // 验证表单
                            validateForm();
                        });
                    }
                }
                
                // 清除所有文件
                const clearSelectionBtn = document.querySelector('.clear-selection');
                if (clearSelectionBtn) {
                    clearSelectionBtn.addEventListener('click', function() {
                        // 清空文件输入
                        fileInput.value = '';
                        // 隐藏预览区域
                        document.querySelector('.upload-preview').style.display = 'none';
                        // 清空预览网格
                        document.querySelector('.preview-grid').innerHTML = '';
                        
                        showNotification('已清除所有已选文件');
                        
                        // 验证表单
                        validateForm();
                    });
                }
                
                // 表单验证
                function validateForm() {
                    let valid = true;
                    
                    // 验证标题
                    if (!document.getElementById('material-title').value.trim()) {
                        valid = false;
                    }
                    
                    // 验证品牌选择
                    if (!document.querySelector('input[name="brand"]:checked')) {
                        valid = false;
                    }
                    
                    // 验证类型选择
                    if (!document.querySelector('input[name="type"]:checked')) {
                        valid = false;
                    }
                    
                    // 文件验证
                    if (fileInput.files.length === 0) {
                        valid = false;
                    }
                    
                    // 更新提交按钮状态
                    document.querySelector('.confirm-upload').disabled = !valid;
                    
                    return valid;
                }
                
                // 文件名填入标题（如果标题为空）
                fileInput.addEventListener('change', function() {
                    if (this.files.length > 0 && !document.getElementById('material-title').value) {
                        const fileName = this.files[0].name.replace(/\.[^/.]+$/, "");
                        document.getElementById('material-title').value = fileName;
                    }
                    
                    // 显示文件名称
                    if (this.files.length > 0) {
                        showNotification(`已选择文件: ${this.files[0].name}`);
                    }
                    
                    // 检查表单是否可提交
                    validateForm();
                });
                
                // 监听表单变化
                document.getElementById('material-title').addEventListener('input', validateForm);
                
                // 单选按钮监听
                modal.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.addEventListener('change', function() {
                        // 添加按钮选择反馈
                        const label = this.parentNode.querySelector('label');
                        label.classList.add('clicked');
                        setTimeout(() => {
                            label.classList.remove('clicked');
                        }, 300);
                        
                        // 显示选择通知
                        if (this.name === 'brand') {
                            showNotification(`已选择品牌: ${this.value}`);
                        } else if (this.name === 'type') {
                            showNotification(`已选择类型: ${this.value}`);
                        }
                        
                        // 验证表单
                        validateForm();
                    });
                });
                
                // 标签建议点击
                modal.querySelectorAll('.suggested-tag').forEach(tag => {
                    tag.addEventListener('click', function() {
                        const tagText = this.textContent.trim();
                        const tagsInput = document.getElementById('material-tags');
                        const currentTags = tagsInput.value.split(',').map(t => t.trim()).filter(t => t);
                        
                        // 如果标签未添加，则添加
                        if (!currentTags.includes(tagText)) {
                            if (currentTags.length > 0) {
                                tagsInput.value = currentTags.join(', ') + ', ' + tagText;
                            } else {
                                tagsInput.value = tagText;
                            }
                            
                            // 添加点击反馈
                            this.classList.add('clicked');
                            setTimeout(() => {
                                this.classList.remove('clicked');
                            }, 300);
                            
                            showNotification(`已添加标签: ${tagText}`);
                        }
                    });
                });
                
                // 表单提交
                modal.querySelector('.confirm-upload').addEventListener('click', function() {
                    if (!validateForm()) {
                        showNotification('请完成所有必填项再上传');
                        return;
                    }
                    
                    // 显示上传进度
                    const progressContainer = modal.querySelector('.upload-progress-container');
                    const progressBar = modal.querySelector('.upload-progress-fill');
                    const progressText = modal.querySelector('.progress-percentage');
                    
                    progressContainer.style.display = '';
                    this.disabled = true;
                    this.textContent = '上传中...';
                    
                    // 模拟上传进度
                    let progress = 0;
                    const progressStep = 2; // 更小的步进值
                    const interval = setInterval(() => {
                        progress += progressStep;
                        
                        // 调整进度增长速度，开始快，接近100%时变慢
                        if (progress > 80) {
                            // 接近完成时放慢速度
                            progress += progressStep * 0.5;
                        } else if (progress > 50) {
                            // 中间阶段正常速度
                            progress += progressStep;
                        } else {
                            // 开始阶段快速增长
                            progress += progressStep * 1.5;
                        }
                        
                        // 确保不超过100%
                        progress = Math.min(progress, 100);
                        
                        progressBar.style.width = `${progress}%`;
                        progressText.textContent = `${Math.round(progress)}%`;
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            
                            setTimeout(() => {
                                // 获取表单数据
                                const title = document.getElementById('material-title').value;
                                const brand = document.querySelector('input[name="brand"]:checked')?.value || '';
                                const type = document.querySelector('input[name="type"]:checked')?.value || '';
                                
                                // 关闭模态窗口
                                closeModal();
                                
                                // 显示成功提示
                                showNotification(`${title} 上传成功！`);
                                
                                // 模拟添加新素材卡片
                                const materialsGrid = document.querySelector('.materials-grid');
                                const newCard = document.createElement('div');
                                newCard.className = 'material-card scroll-reveal';
                                newCard.setAttribute('data-card-id', 'new-card-' + Date.now());
                                
                                if (brand === '安修泽') {
                                    newCard.classList.add('kimtrue-card');
                                }
                                
                                newCard.innerHTML = `
                                    <div class="material-thumbnail">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjBFQkU4IiBmaWxsLW9wYWNpdHk9IjEiPjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIj48L3JlY3Q+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE4cHgiIGZpbGw9IiM2NjYiPuaWsOS4iuS8oOezu+e7n+aehDwvdGV4dD48L3N2Zz4=" alt="${title}">
                                        <div class="material-tags">
                                            ${brand ? `<span class="brand-tag">${brand}</span>` : ''}
                                            <span class="material-type">${type}</span>
                                        </div>
                                    </div>
                                    <div class="material-info">
                                        <div class="material-title">${title}</div>
                                        <div class="material-meta">
                                            <span>800 x 600px</span>
                                            <span>${new Date().toLocaleDateString()}</span>
                                        </div>
                                    </div>
                                    <div class="material-actions">
                                        <button class="action-btn" title="编辑"><i class="fas fa-pencil-alt"></i></button>
                                        <button class="action-btn" title="下载"><i class="fas fa-download"></i></button>
                                        <button class="action-btn" title="更多操作"><i class="fas fa-ellipsis-h"></i></button>
                                    </div>
                                `;
                                
                                // 添加到网格开头
                                const firstCard = materialsGrid.querySelector('.material-card');
                                if (firstCard) {
                                    materialsGrid.insertBefore(newCard, firstCard);
                                } else {
                                    materialsGrid.appendChild(newCard);
                                }
                                
                                // 添加动画效果
                                setTimeout(() => {
                                    newCard.classList.add('visible');
                                }, 100);
                            }, 500);
                        }
                    }, 100);
                });
                
                // 拖放功能
                const dropzone = modal.querySelector('.upload-dropzone');
                
                dropzone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                dropzone.addEventListener('dragleave', function() {
                    this.classList.remove('dragover');
                });
                
                dropzone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    if (e.dataTransfer.files.length > 0) {
                        fileInput.files = e.dataTransfer.files;
                        fileInput.dispatchEvent(new Event('change'));
                    }
                });
            })();
            
            // 添加按钮点击反馈
            const allButtons = document.querySelectorAll('.btn, .action-btn, .pagination-button');
            allButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    // 如果按钮已禁用，不处理点击
                    if (this.disabled) return;
                    
                    // 添加点击反馈
                    this.classList.add('clicked');
                    setTimeout(() => {
                        this.classList.remove('clicked');
                    }, 300);
                    
                    // 为触摸设备添加波纹效果
                    createRippleEffect(this);
                });
            });
            
            // 添加页面加载完成过渡效果
            window.addEventListener('load', function() {
                document.body.classList.add('loaded');
                
                // 延迟一点，确保DOM完全渲染
                setTimeout(() => {
                    // 初始检查滚动动画
                    checkScrollReveal();
                    
                    // 移除加载遮罩（如果有）
                    const loadingOverlay = document.querySelector('.loading-overlay');
                    if (loadingOverlay) {
                        loadingOverlay.classList.add('fade-out');
                        setTimeout(() => {
                            loadingOverlay.remove();
                        }, 500);
                    }
                }, 300);
            });
            
            // 优化移动端显示
            function checkMobileView() {
                if (window.innerWidth <= 768) {
                    document.body.classList.add('mobile-view');
                } else {
                    document.body.classList.remove('mobile-view');
                }
            }
            
            // 初始检查并添加窗口大小变化监听
            checkMobileView();
            window.addEventListener('resize', debounce(checkMobileView, 250));
            
            // 优化加载失败的图片显示
            const allImages = document.querySelectorAll('img');
            allImages.forEach(img => {
                img.addEventListener('error', function() {
                    // 替换为占位图
                    this.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjZTBlMGUwIiBmaWxsLW9wYWNpdHk9IjAuNSI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIyMDAiPjwvcmVjdD48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMThweCIgZmlsbD0iIzY2NiI+5Zu+54mH5Yqg6L295aSx6LSlPC90ZXh0Pjwvc3ZnPg==';
                    this.alt = '图片加载失败';
                    // 添加错误类，可以用CSS自定义样式
                    this.classList.add('img-error');
                });
            });
            
            // 初始化页面
            showAllMaterials();
            initScrollReveal();
            
            // 检查滚动元素可见性
            function checkScrollReveal() {
                const cards = document.querySelectorAll('.scroll-reveal:not(.visible)');
                cards.forEach(card => {
                    // 使用dataset属性而不是直接在DOM对象上存储状态
                    if (card.dataset.isVisible !== 'true') {
                        const cardTop = card.getBoundingClientRect().top;
                        const windowHeight = window.innerHeight;
                        
                        if (cardTop < windowHeight * 0.9) {
                            card.classList.add('visible');
                            // 标记为已可见，避免重复计算
                            card.dataset.isVisible = 'true';
                        }
                    }
                });
            }
            
            // 处理高级筛选按钮
            const advancedFilterBtn = document.getElementById('advanced-filter-btn');
            const advancedFilterPopover = document.getElementById('advanced-filter-popover');
            
            if (advancedFilterBtn && advancedFilterPopover) {
                advancedFilterBtn.addEventListener('click', function(e) {
                    e.stopPropagation(); // 阻止事件冒泡
                    
                    // 切换弹窗显示状态
                    advancedFilterPopover.classList.toggle('active');
                    this.classList.toggle('active');
                    
                    // 定位弹窗
                    const btnRect = this.getBoundingClientRect();
                    advancedFilterPopover.style.top = (btnRect.bottom + 8) + 'px';
                    advancedFilterPopover.style.right = (window.innerWidth - btnRect.right) + 'px';
                });
                
                // 点击外部关闭弹窗
                document.addEventListener('click', function(e) {
                    if (!advancedFilterPopover.contains(e.target) && e.target !== advancedFilterBtn) {
                        advancedFilterPopover.classList.remove('active');
                        advancedFilterBtn.classList.remove('active');
                    }
                });
                
                // 应用筛选按钮
                const applyFilterBtn = document.getElementById('apply-filter');
                if (applyFilterBtn) {
                    applyFilterBtn.addEventListener('click', function() {
                        // 获取已选择的筛选选项
                        const selectedFilters = [];
                        const activeOptions = advancedFilterPopover.querySelectorAll('.filter-option.active:not([data-value="all"])');
                        
                        activeOptions.forEach(option => {
                            const filterType = option.getAttribute('data-filter');
                            const filterValue = option.getAttribute('data-value');
                            selectedFilters.push({ type: filterType, value: filterValue });
                        });
                        
                        // 关闭弹窗
                        advancedFilterPopover.classList.remove('active');
                        advancedFilterBtn.classList.remove('active');
                        
                        // 显示筛选结果
                        if (selectedFilters.length > 0) {
                            showNotification(`已应用 ${selectedFilters.length} 个筛选条件`);
                            
                            // 显示活跃筛选条件区域
                            const activeFiltersArea = document.getElementById('active-filters');
                            const activeFilterChips = document.querySelector('.active-filter-chips');
                            
                            if (activeFiltersArea && activeFilterChips) {
                                activeFiltersArea.style.display = '';
                                activeFilterChips.innerHTML = '';
                                
                                // 添加筛选条件标签
                                selectedFilters.forEach(filter => {
                                    const chip = document.createElement('div');
                                    chip.className = 'filter-chip';
                                    chip.innerHTML = `${filter.value} <i class="fas fa-times"></i>`;
                                    chip.dataset.type = filter.type;
                                    chip.dataset.value = filter.value;
                                    
                                    // 添加关闭图标点击事件
                                    chip.querySelector('i').addEventListener('click', function(e) {
                                        e.stopPropagation();
                                        
                                        // 移除此标签
                                        chip.remove();
                                        
                                        // 更新筛选选项状态
                                        const option = advancedFilterPopover.querySelector(`.filter-option[data-filter="${filter.type}"][data-value="${filter.value}"]`);
                                        if (option) {
                                            option.classList.remove('active');
                                            
                                            // 如果该组没有选中的选项，则激活"全部"选项
                                            const filterGroup = option.closest('.filter-option-group');
                                            const activeOptions = filterGroup.querySelectorAll('.filter-option.active');
                                            if (activeOptions.length === 0) {
                                                filterGroup.querySelector('.filter-option[data-value="all"]').classList.add('active');
                                            }
                                        }
                                        
                                        // 如果没有筛选条件了，隐藏筛选条件区域
                                        if (activeFilterChips.children.length === 0) {
                                            activeFiltersArea.style.display = 'none';
                                        }
                                        
                                        showNotification('已移除筛选条件: ' + filter.value);
                                    });
                                    
                                    activeFilterChips.appendChild(chip);
                                });
                                
                                // 添加清除全部按钮点击事件
                                const clearFiltersBtn = document.querySelector('.clear-filters-btn');
                                if (clearFiltersBtn) {
                                    clearFiltersBtn.addEventListener('click', function() {
                                        // 清空筛选标签
                                        activeFilterChips.innerHTML = '';
                                        
                                        // 隐藏筛选条件区域
                                        activeFiltersArea.style.display = 'none';
                                        
                                        // 重置筛选选项
                                        const allOptions = advancedFilterPopover.querySelectorAll('.filter-option');
                                        allOptions.forEach(option => {
                                            option.classList.remove('active');
                                            
                                            // 重新激活"全部"选项
                                            if (option.getAttribute('data-value') === 'all') {
                                                option.classList.add('active');
                                            }
                                        });
                                        
                                        showNotification('已清除所有筛选条件');
                                    });
                                }
                            }
                        } else {
                            showNotification('未选择任何筛选条件');
                        }
                    });
                }
                
                // 重置筛选按钮
                const resetFilterBtn = document.getElementById('filter-reset');
                if (resetFilterBtn) {
                    resetFilterBtn.addEventListener('click', function() {
                        // 重置所有筛选选项
                        const allOptions = advancedFilterPopover.querySelectorAll('.filter-option');
                        allOptions.forEach(option => {
                            option.classList.remove('active');
                            
                            // 重新激活"全部"选项
                            if (option.getAttribute('data-value') === 'all') {
                                option.classList.add('active');
                            }
                        });
                        
                        showNotification('已重置筛选条件');
                    });
                }
                
                // 处理筛选选项点击
                const filterOptions = advancedFilterPopover.querySelectorAll('.filter-option');
                filterOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const filterGroup = this.closest('.filter-option-group');
                        const isAll = this.getAttribute('data-value') === 'all';
                        
                        // "全部"选项的处理
                        if (isAll) {
                            // 取消同组其他选项的选中状态
                            filterGroup.querySelectorAll('.filter-option').forEach(opt => {
                                opt.classList.remove('active');
                            });
                            this.classList.add('active');
                        } else {
                            // 取消同组"全部"选项的选中状态
                            filterGroup.querySelector('.filter-option[data-value="all"]').classList.remove('active');
                            // 切换当前选项的选中状态
                            this.classList.toggle('active');
                            
                            // 如果没有选中项，则重新选中"全部"选项
                            const activeOptions = filterGroup.querySelectorAll('.filter-option.active');
                            if (activeOptions.length === 0) {
                                filterGroup.querySelector('.filter-option[data-value="all"]').classList.add('active');
                            }
                        }
                    });
                });
            }
        });
    </script>

    <!-- 上传素材模态窗口 -->
    <div id="upload-modal" class="modal-container">
        <div class="modal-overlay"></div>
        <div class="modal-content upload-modal">
            <div class="modal-header">
                <h3>上传素材</h3>
                <button class="modal-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="upload-tabs">
                    <button class="upload-tab active" data-tab="upload-file">从本地上传</button>
                    <button class="upload-tab" data-tab="upload-url">从网络导入</button>
                </div>
                
                <div class="upload-tab-content active" id="upload-file">
                    <div class="upload-dropzone">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p class="upload-text">拖放文件至此处或<span class="upload-browse">浏览文件</span></p>
                        <p class="upload-hint">支持JPG, PNG, SVG, GIF文件，最大20MB</p>
                        <input type="file" id="file-upload" class="file-input" accept="image/*" multiple>
                    </div>
                    
                    <div class="upload-preview" style="display: none;">
                        <div class="preview-header">
                            <div class="preview-count"><span id="selected-files-count">0</span> 个文件已选择</div>
                            <div class="preview-actions">
                                <button class="btn btn-sm btn-outline batch-action" data-action="apply-all"><i class="fas fa-link"></i> 应用相同信息</button>
                                <button class="btn btn-sm btn-outline clear-selection"><i class="fas fa-redo"></i> 重新选择</button>
                            </div>
                        </div>
                        <div class="preview-grid"></div>
                    </div>
                </div>
                
                <div class="upload-tab-content" id="upload-url">
                    <div class="form-group">
                        <label for="url-input">图片URL</label>
                        <input type="url" id="url-input" class="form-control" placeholder="https://example.com/image.jpg">
                    </div>
                    <button class="btn btn-outline fetch-url"><i class="fas fa-download"></i> 获取图片</button>
                    
                    <div class="url-preview" style="display: none;"></div>
                </div>
                
                <div class="material-meta-form">
                    <div class="form-section-title">基本信息</div>
                    <div class="form-group">
                        <label for="material-title">素材名称 <span class="required">*</span></label>
                        <input type="text" id="material-title" class="form-control" placeholder="为素材添加一个名称">
                    </div>
                    
                    <!-- 批量应用表单 -->
                    <div class="batch-apply-form" id="batch-apply-form" style="display: none;">
                        <div class="batch-status">
                            <div class="batch-status-text">将批量应用设置到 <span id="batch-count">0</span> 个文件</div>
                            <button class="btn-sm btn-outline" id="batch-cancel"><i class="fas fa-times"></i> 取消</button>
                        </div>
                        
                        <div class="form-section-title">批量设置</div>
                        
                        <div class="form-group">
                            <label>品牌选择</label>
                            <div class="brand-selection">
                                <div class="brand-option">
                                    <input type="radio" name="batch-brand" id="batch-brand-generic" value="通用">
                                    <label for="batch-brand-generic">
                                        <div class="brand-icon generic-brand">无</div>
                                        <span>通用</span>
                                    </label>
                                </div>
                                <div class="brand-option">
                                    <input type="radio" name="batch-brand" id="batch-brand-anxiuze" value="安修泽">
                                    <label for="batch-brand-anxiuze">
                                        <div class="brand-icon anxiuze-brand">安</div>
                                        <span>安修泽</span>
                                    </label>
                                </div>
                                <div class="brand-option">
                                    <input type="radio" name="batch-brand" id="batch-brand-qichu" value="且初">
                                    <label for="batch-brand-qichu">
                                        <div class="brand-icon qichu-brand">且</div>
                                        <span>且初</span>
                                    </label>
                                </div>
                                <div class="brand-option">
                                    <input type="radio" name="batch-brand" id="batch-brand-ddg" value="ddg">
                                    <label for="batch-brand-ddg">
                                        <div class="brand-icon ddg-brand">D</div>
                                        <span>ddg</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>素材类型</label>
                            <div class="type-selection">
                                <div class="type-option">
                                    <input type="radio" name="batch-type" id="batch-type-image" value="图片">
                                    <label for="batch-type-image">
                                        <i class="fas fa-image"></i>
                                        <span>图片</span>
                                    </label>
                                </div>
                                <div class="type-option">
                                    <input type="radio" name="batch-type" id="batch-type-icon" value="图标">
                                    <label for="batch-type-icon">
                                        <i class="fas fa-icons"></i>
                                        <span>图标</span>
                                    </label>
                                </div>
                                <div class="type-option">
                                    <input type="radio" name="batch-type" id="batch-type-pattern" value="图形">
                                    <label for="batch-type-pattern">
                                        <i class="fas fa-draw-polygon"></i>
                                        <span>图形</span>
                                    </label>
                                </div>
                                <div class="type-option">
                                    <input type="radio" name="batch-type" id="batch-type-background" value="背景">
                                    <label for="batch-type-background">
                                        <i class="fas fa-paint-roller"></i>
                                        <span>背景</span>
                                    </label>
                                </div>
                                <div class="type-option">
                                    <input type="radio" name="batch-type" id="batch-type-logo" value="Logo">
                                    <label for="batch-type-logo">
                                        <i class="fas fa-copyright"></i>
                                        <span>Logo</span>
                                    </label>
                                </div>
                                <div class="type-option">
                                    <input type="radio" name="batch-type" id="batch-type-video" value="视频">
                                    <label for="batch-type-video">
                                        <i class="fas fa-video"></i>
                                        <span>视频</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>标签设置</label>
                            <input type="text" id="batch-tags" class="form-control" placeholder="添加标签，用逗号分隔">
                        </div>
                        
                        <div class="form-group text-right">
                            <button class="btn btn-primary" id="apply-batch-settings">应用到所有选中文件</button>
                        </div>
                    </div>
                    
                    <!-- 批量上传预览区域 -->
                    <div class="batch-upload-preview" style="display: none;">
                        <div class="preview-header">
                            <h4>文件预览 (<span id="selected-files-count">0</span>个文件)</h4>
                            <div class="preview-actions">
                                <button class="btn btn-sm btn-light" id="clear-files"><i class="fas fa-trash-alt"></i> 清除全部</button>
                            </div>
                        </div>
                        <div class="preview-filter-bar">
                            <div class="filter-label">筛选预览:</div>
                            <div class="filter-buttons">
                                <button class="filter-btn active" data-filter="all">全部</button>
                                <button class="filter-btn" data-filter="image">图片</button>
                                <button class="filter-btn" data-filter="svg">SVG</button>
                                <button class="filter-btn" data-filter="pdf">PDF</button>
                                <button class="filter-btn" data-filter="video">视频</button>
                            </div>
                            <div class="file-counter"><span id="filtered-count">0</span>/<span id="total-count">0</span></div>
                        </div>
                        <div class="preview-grid" id="file-preview-grid"></div>
                    </div>
                    
                    <div class="form-section-title">分类信息</div>
                    <div class="form-group">
                        <label>品牌选择 <span class="required">*</span></label>
                        <div class="brand-selection">
                            <div class="brand-option">
                                <input type="radio" name="brand" id="brand-generic" value="通用">
                                <label for="brand-generic">
                                    <div class="brand-icon generic-brand">无</div>
                                    <span>通用</span>
                                </label>
                            </div>
                            <div class="brand-option">
                                <input type="radio" name="brand" id="brand-anxiuze" value="安修泽">
                                <label for="brand-anxiuze">
                                    <div class="brand-icon anxiuze-brand">安</div>
                                    <span>安修泽</span>
                                </label>
                            </div>
                            <div class="brand-option">
                                <input type="radio" name="brand" id="brand-qichu" value="且初">
                                <label for="brand-qichu">
                                    <div class="brand-icon qichu-brand">且</div>
                                    <span>且初</span>
                                </label>
                            </div>
                            <div class="brand-option">
                                <input type="radio" name="brand" id="brand-ddg" value="ddg">
                                <label for="brand-ddg">
                                    <div class="brand-icon ddg-brand">D</div>
                                    <span>ddg</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>素材类型 <span class="required">*</span></label>
                        <div class="type-selection">
                            <div class="type-option">
                                <input type="radio" name="type" id="type-image" value="图片">
                                <label for="type-image">
                                    <i class="fas fa-image"></i>
                                    <span>图片</span>
                                </label>
                            </div>
                            <div class="type-option">
                                <input type="radio" name="type" id="type-icon" value="图标">
                                <label for="type-icon">
                                    <i class="fas fa-icons"></i>
                                    <span>图标</span>
                                </label>
                            </div>
                            <div class="type-option">
                                <input type="radio" name="type" id="type-pattern" value="图形">
                                <label for="type-pattern">
                                    <i class="fas fa-draw-polygon"></i>
                                    <span>图形</span>
                                </label>
                            </div>
                            <div class="type-option">
                                <input type="radio" name="type" id="type-background" value="背景">
                                <label for="type-background">
                                    <i class="fas fa-paint-roller"></i>
                                    <span>背景</span>
                                </label>
                            </div>
                            <div class="type-option">
                                <input type="radio" name="type" id="type-logo" value="Logo">
                                <label for="type-logo">
                                    <i class="fas fa-copyright"></i>
                                    <span>Logo</span>
                                </label>
                            </div>
                            <div class="type-option">
                                <input type="radio" name="type" id="type-video" value="视频">
                                <label for="type-video">
                                    <i class="fas fa-video"></i>
                                    <span>视频</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section-title">标签信息 <span class="optional-tag">可选</span></div>
                    <div class="form-group">
                        <label for="material-tags">标签</label>
                        <input type="text" id="material-tags" class="form-control" placeholder="添加标签，用逗号分隔">
                        <div class="tag-suggestion">
                            <span class="suggested-tag">产品</span>
                            <span class="suggested-tag">营销</span>
                            <span class="suggested-tag">节日</span>
                            <span class="suggested-tag">社交</span>
                        </div>
                    </div>
                </div>
                
                <div class="upload-progress-container" style="display: none;">
                    <div class="upload-progress-text">正在上传... <span class="progress-percentage">0%</span></div>
                    <div class="upload-progress-bar">
                        <div class="upload-progress-fill"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light cancel-upload">取消</button>
                <button class="btn btn-primary confirm-upload" disabled>上传素材</button>
            </div>
        </div>
    </div>

    <!-- 高级筛选弹窗 -->
    <div class="advanced-filter-popover" id="advanced-filter-popover">
        <div class="filter-section">
            <div class="filter-section-title">品牌</div>
            <div class="filter-option-group">
                <div class="filter-option active" data-filter="brand" data-value="all">所有品牌</div>
                <div class="filter-option" data-filter="brand" data-value="安修泽">安修泽</div>
                <div class="filter-option" data-filter="brand" data-value="且初">且初</div>
                <div class="filter-option" data-filter="brand" data-value="ddg">ddg</div>
            </div>
        </div>
        
        <div class="filter-section">
            <div class="filter-section-title">素材类型</div>
            <div class="filter-option-group">
                <div class="filter-option active" data-filter="type" data-value="all">所有类型</div>
                <div class="filter-option" data-filter="type" data-value="图片">图片</div>
                <div class="filter-option" data-filter="type" data-value="图标">图标</div>
                <div class="filter-option" data-filter="type" data-value="图形">图形</div>
                <div class="filter-option" data-filter="type" data-value="背景">背景</div>
                <div class="filter-option" data-filter="type" data-value="Logo">Logo</div>
                <div class="filter-option" data-filter="type" data-value="视频">视频</div>
            </div>
        </div>
        
        <div class="filter-section">
            <div class="filter-section-title">上传时间</div>
            <div class="filter-option-group">
                <div class="filter-option active" data-filter="time" data-value="all">全部时间</div>
                <div class="filter-option" data-filter="time" data-value="today">今天</div>
                <div class="filter-option" data-filter="time" data-value="week">本周</div>
                <div class="filter-option" data-filter="time" data-value="month">本月</div>
            </div>
        </div>
        
        <div class="filter-actions">
            <button class="filter-reset" id="filter-reset">重置筛选</button>
            <button class="btn btn-primary" id="apply-filter">应用筛选</button>
        </div>
    </div>
</body>
</html>


