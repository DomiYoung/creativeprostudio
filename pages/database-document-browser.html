<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CreativePro Studio 数据库文档浏览器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        :root {
            /* Apple 设计色彩系统 */
            --blue: #007aff;
            --indigo: #5856d6;
            --purple: #af52de;
            --pink: #ff2d55;
            --red: #ff3b30;
            --orange: #ff9500;
            --yellow: #ffcc00;
            --green: #34c759;
            --mint: #00c7be;
            --teal: #30b0c7;
            --cyan: #32ade6;
            --gray: #8e8e93;
            --gray2: #aeaeb2;
            --gray3: #c7c7cc;
            --gray4: #d1d1d6;
            --gray5: #e5e5ea;
            --gray6: #f2f2f7;
            
            /* 品牌色 */
            --brand-orange: #F5E1D9;
            --brand-pink: #FFB5C5;
            --mint-green: #B6E5D8;
            --sky-blue: #97C1FF;
            --soft-purple: #D5B3FF;
            --cream-yellow: #FFE599;
            
            /* 间距 */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-xxl: 48px;
            
            /* 圆角 */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            /* 字体大小 */
            --font-xs: 12px;
            --font-sm: 14px;
            --font-md: 16px;
            --font-lg: 20px;
            --font-xl: 24px;
            --font-xxl: 32px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
            background-color: var(--gray6);
            color: #000;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        
        header {
            background-color: white;
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--gray5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 64px;
            flex-shrink: 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        
        .logo-text {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--brand-orange);
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background-color: var(--brand-orange);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .search-bar {
            flex: 1;
            max-width: 500px;
            margin: 0 var(--spacing-lg);
            position: relative;
        }
        
        .search-bar input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-lg);
            padding-left: 36px;
            border-radius: 8px;
            border: none;
            background-color: var(--gray6);
            font-size: var(--font-md);
            outline: none;
        }
        
        .search-bar i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        
        .toolbar {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }
        
        .toolbar-btn {
            background: none;
            border: none;
            color: var(--gray);
            font-size: var(--font-lg);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        
        .toolbar-btn:hover {
            background-color: var(--gray6);
            color: var(--blue);
        }
        
        main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .sidebar {
            width: 280px;
            background-color: white;
            border-right: 1px solid var(--gray5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .sidebar-header {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--gray5);
            font-weight: 600;
            color: var(--gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-md) 0;
        }
        
        .db-category {
            margin-bottom: var(--spacing-md);
        }
        
        .category-header {
            padding: var(--spacing-xs) var(--spacing-md);
            font-weight: 600;
            color: var(--gray);
            font-size: var(--font-sm);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .category-header:hover {
            color: var(--blue);
        }
        
        .category-header i {
            margin-right: var(--spacing-sm);
            transition: transform 0.2s;
        }
        
        .category-header.collapsed i {
            transform: rotate(-90deg);
        }
        
        .table-list {
            list-style: none;
        }
        
        .table-item {
            padding: var(--spacing-xs) var(--spacing-md);
            padding-left: var(--spacing-xl);
            cursor: pointer;
            font-size: var(--font-sm);
            display: flex;
            align-items: center;
            border-left: 3px solid transparent;
        }
        
        .table-item:hover {
            background-color: var(--gray6);
        }
        
        .table-item.active {
            background-color: rgba(0, 122, 255, 0.1);
            color: var(--blue);
            border-left-color: var(--blue);
        }
        
        .table-item .icon {
            width: 20px;
            margin-right: var(--spacing-sm);
            text-align: center;
        }
        
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-lg);
            background-color: white;
        }
        
        .db-header {
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--gray5);
        }
        
        .db-title {
            font-size: var(--font-xl);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .db-description {
            color: var(--gray);
            margin-bottom: var(--spacing-md);
        }
        
        .tab-container {
            margin-bottom: var(--spacing-lg);
        }
        
        .tab-header {
            display: flex;
            border-bottom: 1px solid var(--gray5);
            margin-bottom: var(--spacing-md);
        }
        
        .tab {
            padding: var(--spacing-sm) var(--spacing-md);
            cursor: pointer;
            font-weight: 500;
            color: var(--gray);
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            color: var(--blue);
            border-bottom-color: var(--blue);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section-title {
            font-size: var(--font-lg);
            font-weight: 600;
            margin: var(--spacing-lg) 0 var(--spacing-md);
            color: #1D1D1F;
        }
        
        .section-subtitle {
            font-size: var(--font-md);
            font-weight: 500;
            margin: var(--spacing-md) 0 var(--spacing-sm);
            color: #1D1D1F;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: var(--spacing-md) 0;
            font-size: var(--font-sm);
        }
        
        th {
            text-align: left;
            padding: var(--spacing-sm) var(--spacing-md);
            background-color: var(--gray6);
            color: var(--gray);
            font-weight: 500;
        }
        
        td {
            padding: var(--spacing-sm) var(--spacing-md);
            border-top: 1px solid var(--gray5);
        }
        
        tr:hover td {
            background-color: rgba(0, 0, 0, 0.02);
        }
        
        .code-block {
            background-color: #f6f8fa;
            border-radius: var(--radius-sm);
            padding: var(--spacing-md);
            overflow-x: auto;
            font-family: "SF Mono", monospace;
            font-size: var(--font-sm);
            margin: var(--spacing-md) 0;
        }
        
        .code-block pre {
            margin: 0;
        }
        
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: var(--font-xs);
            font-weight: 500;
            margin-right: var(--spacing-xs);
        }
        
        .badge-primary {
            background-color: rgba(0, 122, 255, 0.1);
            color: var(--blue);
        }
        
        .badge-foreign {
            background-color: rgba(175, 82, 222, 0.1);
            color: var(--purple);
        }
        
        .badge-index {
            background-color: rgba(52, 199, 89, 0.1);
            color: var(--green);
        }
        
        .badge-nullable {
            background-color: rgba(142, 142, 147, 0.1);
            color: var(--gray);
        }
        
        .badge-required {
            background-color: rgba(255, 45, 85, 0.1);
            color: var(--red);
        }
        
        .warning-banner {
            background-color: rgba(255, 204, 0, 0.1);
            border-left: 4px solid var(--yellow);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: #8a6d00;
        }
        
        .db-diagram {
            width: 100%;
            border: 1px solid var(--gray5);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
            background-color: white;
        }
        
        .db-diagram img {
            max-width: 100%;
            display: block;
            margin: 0 auto;
        }
        
        .constraints-list {
            margin-bottom: var(--spacing-md);
        }
        
        .constraint-item {
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--gray5);
        }
        
        .constraint-name {
            font-weight: 500;
            margin-bottom: var(--spacing-xs);
        }
        
        .constraint-description {
            font-size: var(--font-sm);
            color: var(--gray);
        }
        
        .indexes-list {
            margin-bottom: var(--spacing-md);
        }
        
        .index-item {
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--gray5);
        }
        
        .index-name {
            font-weight: 500;
            margin-bottom: var(--spacing-xs);
        }
        
        .index-description {
            font-size: var(--font-sm);
            color: var(--gray);
        }
        
        /* 深色主题 */
        body.dark-theme {
            background-color: #1c1c1e;
            color: #f5f5f7;
        }
        
        body.dark-theme header,
        body.dark-theme .sidebar,
        body.dark-theme .content-area,
        body.dark-theme .db-diagram {
            background-color: #2c2c2e;
            border-color: #3c3c3e;
        }
        
        body.dark-theme .sidebar-header,
        body.dark-theme .db-header,
        body.dark-theme .constraint-item,
        body.dark-theme .index-item {
            border-color: #3c3c3e;
        }
        
        body.dark-theme .table-item:hover {
            background-color: #3c3c3e;
        }
        
        body.dark-theme .table-item.active {
            background-color: rgba(10, 132, 255, 0.2);
            color: var(--blue);
            border-left-color: var(--blue);
        }
        
        body.dark-theme .search-bar input {
            background-color: #3c3c3e;
            color: #f5f5f7;
        }
        
        body.dark-theme .toolbar-btn {
            color: #8e8e93;
        }
        
        body.dark-theme .toolbar-btn:hover {
            background-color: #3c3c3e;
            color: var(--blue);
        }
        
        body.dark-theme th {
            background-color: #3c3c3e;
            color: #8e8e93;
        }
        
        body.dark-theme td {
            border-color: #3c3c3e;
        }
        
        body.dark-theme tr:hover td {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        body.dark-theme .code-block {
            background-color: #2a2a2c;
            color: #e4e4e4;
        }
        
        body.dark-theme .tab.active {
            color: var(--blue);
            border-color: var(--blue);
        }
        
        body.dark-theme .warning-banner {
            background-color: rgba(255, 204, 0, 0.1);
            border-left: 4px solid var(--yellow);
            color: var(--yellow);
        }
        
        body.dark-theme .constraint-description,
        body.dark-theme .index-description {
            color: var(--gray3);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 240px;
            }
            
            .search-bar {
                max-width: 200px;
                margin: 0 var(--spacing-sm);
            }
        }
        
        /* 添加mermaid图表样式 */
        .mermaid {
            background-color: white;
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            margin: var(--spacing-md) 0;
            max-width: 100%;
            overflow-x: auto;
        }
        
        body.dark-theme .mermaid {
            background-color: #2a2a2c;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-database"></i>
            </div>
            <div class="logo-text">数据库文档浏览器</div>
        </div>
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="搜索表、字段或关系...">
        </div>
        <div class="toolbar">
            <button class="toolbar-btn" title="切换主题">
                <i class="fas fa-moon"></i>
            </button>
            <button class="toolbar-btn" title="下载文档">
                <i class="fas fa-download"></i>
            </button>
        </div>
    </header>
    <main>
        <div class="sidebar">
            <div class="sidebar-header">
                <span>数据模型</span>
                <button class="toolbar-btn" title="折叠所有">
                    <i class="fas fa-compress-alt"></i>
                </button>
            </div>
            <div class="sidebar-content" id="db-navigation">
                <!-- 数据库导航将通过 JavaScript 动态生成 -->
                <div class="warning-banner">
                    <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                    数据库文档正在完善中，部分表结构信息可能不完整。
                </div>
            </div>
        </div>
        <div class="content-area" id="db-content">
            <!-- 数据库内容将通过 JavaScript 动态生成 -->
            <div class="db-header">
                <h1 class="db-title">CreativePro Studio 数据库文档</h1>
                <p class="db-description">欢迎使用 CreativePro Studio 数据库文档浏览器。请从左侧选择表查看详细信息。</p>
            </div>
            
            <div class="section-title">概述</div>
            <p>CreativePro Studio 数据库采用关系型数据库设计，支持批处理图片设计和审核流程管理。本文档提供了完整的表结构、关系和约束信息。</p>
            
            <div class="section-title">数据库架构</div>
            <div class="db-diagram">
                <div class="mermaid">
                    erDiagram
                    %% 用户与权限模块
                    User {
                        uuid ID PK
                        string Username UK
                        string Email UK
                        string PasswordHash
                        string AvatarURL
                        tinyint Status
                        datetime CreatedAt
                        datetime UpdatedAt
                    }
                    
                    Role {
                        int ID PK
                        string Name UK
                        string Description
                        datetime CreatedAt
                    }
                    
                    Permission {
                        int ID PK
                        string Code UK
                        string Name
                        string Category
                    }
                    
                    UserRole {
                        uuid UserID PK,FK
                        int RoleID PK,FK
                        datetime AssignedAt
                    }
                    
                    RolePermission {
                        int RoleID PK,FK
                        int PermissionID PK,FK
                    }
                    
                    %% 资源管理模块
                    Asset {
                        uuid ID PK
                        string Name
                        string Type
                        string URL
                        json Metadata
                        uuid OwnerID FK
                        tinyint Status
                        datetime CreatedAt
                    }
                    
                    AssetTag {
                        uuid AssetID PK,FK
                        string Tag PK
                    }
                    
                    AssetCategory {
                        int ID PK
                        string Name UK
                        int ParentID FK
                        int SortOrder
                    }
                    
                    AssetCategoryMapping {
                        uuid AssetID PK,FK
                        int CategoryID PK,FK
                    }
                    
                    %% 模板管理模块
                    Template {
                        uuid ID PK
                        string Name
                        string Description
                        uuid CreatorID FK
                        json TemplateData
                        json Variables
                        string PreviewURL
                        tinyint Status
                        string Version
                        datetime CreatedAt
                    }
                    
                    TemplateCategory {
                        int ID PK
                        string Name UK
                        int ParentID FK
                        int SortOrder
                    }
                    
                    TemplateVersion {
                        uuid ID PK
                        uuid TemplateID FK
                        string Version
                        boolean IsPublished
                    }
                    
                    TemplateElement {
                        uuid ID PK
                        uuid TemplateVersionID FK
                        string Type
                        string Properties
                    }
                    
                    %% 批处理项目模块
                    Project {
                        uuid ID PK
                        string Name
                        string Description
                        uuid CreatorID FK
                        tinyint Status
                        json DataSource
                        datetime CreatedAt
                        datetime CompletedAt
                    }
                    
                    ProjectAsset {
                        uuid ID PK
                        uuid ProjectID FK
                        uuid AssetID FK
                        json VariableValues
                        int SortOrder
                    }
                    
                    BatchTask {
                        uuid ID PK
                        uuid ProjectID FK
                        uuid TemplateID FK
                        string Name
                        tinyint Status
                        float Progress
                        tinyint Priority
                        json Parameters
                        datetime CreatedAt
                    }
                    
                    BatchTaskItem {
                        uuid ID PK
                        uuid BatchTaskID FK
                        uuid AssetID FK
                        tinyint Status
                        string Result
                        string ErrorMessage
                    }
                    
                    %% 审核系统模块
                    AuditFlow {
                        uuid ID PK
                        string Name UK
                        string Description
                        json FlowDefinition
                        tinyint Status
                        uuid CreatedByID FK
                        datetime CreatedAt
                    }
                    
                    AuditTask {
                        uuid ID PK
                        uuid AuditFlowID FK
                        uuid ProjectID FK
                        uuid BatchTaskID FK
                        tinyint Status
                        string CurrentNodeID
                        uuid InitiatorID FK
                        string Title
                        tinyint Priority
                        datetime DueDate
                        datetime CreatedAt
                        datetime CompletedAt
                    }
                    
                    AuditItem {
                        uuid ID PK
                        uuid AuditTaskID FK
                        uuid BatchTaskItemID FK
                        tinyint Status
                        string Feedback
                        boolean ModificationRequired
                        datetime CreatedAt
                    }
                    
                    AuditRecord {
                        uuid ID PK
                        uuid AuditTaskID FK
                        string NodeID
                        uuid AuditorID FK
                        tinyint Action
                        string Comments
                        json Attachments
                        datetime CreatedAt
                    }
                    
                    AuditFeedback {
                        uuid ID PK
                        uuid AuditItemID FK
                        uuid AuditRecordID FK
                        string Content
                        tinyint Type
                        json Position
                        string AttachmentURL
                        uuid CreatedBy FK
                        datetime CreatedAt
                    }
                    
                    %% 关系定义
                    %% 用户权限关系
                    User ||--o{ UserRole : "拥有"
                    Role ||--o{ UserRole : "分配给"
                    Role ||--o{ RolePermission : "包含"
                    Permission ||--o{ RolePermission : "授予"
                    
                    %% 资源关系
                    User ||--o{ Asset : "拥有"
                    Asset ||--o{ AssetTag : "拥有"
                    AssetCategory ||--o{ AssetCategoryMapping : "包含"
                    Asset ||--o{ AssetCategoryMapping : "属于"
                    AssetCategory ||--o{ AssetCategory : "包含子类"
                    
                    %% 模板关系
                    User ||--o{ Template : "创建"
                    TemplateCategory ||--o{ Template : "包含"
                    TemplateCategory ||--o{ TemplateCategory : "包含子类"
                    Template ||--o{ TemplateVersion : "拥有"
                    TemplateVersion ||--o{ TemplateElement : "包含"
                    
                    %% 项目及批处理关系
                    User ||--o{ Project : "创建"
                    Project ||--o{ ProjectAsset : "包含"
                    Asset ||--o{ ProjectAsset : "用于"
                    Project ||--o{ BatchTask : "创建"
                    Template ||--o{ BatchTask : "应用"
                    BatchTask ||--o{ BatchTaskItem : "包含"
                    Asset ||--o{ BatchTaskItem : "处理"
                    
                    %% 审核关系
                    User ||--o{ AuditFlow : "创建"
                    AuditFlow ||--o{ AuditTask : "应用"
                    Project ||--o{ AuditTask : "关联"
                    BatchTask ||--o{ AuditTask : "审核"
                    User ||--o{ AuditTask : "发起"
                    AuditTask ||--o{ AuditItem : "包含"
                    BatchTaskItem ||--o{ AuditItem : "关联"
                    AuditTask ||--o{ AuditRecord : "记录"
                    User ||--o{ AuditRecord : "提交"
                    AuditItem ||--o{ AuditFeedback : "收集"
                    AuditRecord ||--o{ AuditFeedback : "关联"
                    User ||--o{ AuditFeedback : "创建"
                </div>
            </div>
            
            <div class="section-title">主要表组</div>
            <table>
                <tr>
                    <th>表组名</th>
                    <th>描述</th>
                    <th>主要表</th>
                </tr>
                <tr>
                    <td>审核相关表</td>
                    <td>管理审核流程、审核任务和审核项</td>
                    <td>AuditTask, AuditFlow, AuditItem</td>
                </tr>
                <tr>
                    <td>批处理相关表</td>
                    <td>管理批处理任务和处理项</td>
                    <td>BatchTask, BatchTaskItem</td>
                </tr>
                <tr>
                    <td>素材相关表</td>
                    <td>管理素材资源和分类</td>
                    <td>Asset, AssetCategory, AssetTag</td>
                </tr>
                <tr>
                    <td>模板相关表</td>
                    <td>管理设计模板和模板元素</td>
                    <td>Template, TemplateVersion, TemplateElement</td>
                </tr>
            </table>
            
            <div class="section-title">数据库规范</div>
            <ul class="constraints-list">
                <li class="constraint-item">
                    <div class="constraint-name">命名规范</div>
                    <div class="constraint-description">表名使用PascalCase，字段名使用camelCase，外键使用"表名Id"格式。</div>
                </li>
                <li class="constraint-item">
                    <div class="constraint-name">主键规范</div>
                    <div class="constraint-description">所有表使用GUID作为主键，字段名为"Id"。</div>
                </li>
                <li class="constraint-item">
                    <div class="constraint-name">审计字段</div>
                    <div class="constraint-description">所有表包含CreatedAt, UpdatedAt, CreatedBy, UpdatedBy字段。</div>
                </li>
                <li class="constraint-item">
                    <div class="constraint-name">软删除</div>
                    <div class="constraint-description">支持软删除的表包含IsDeleted字段和DeletedAt字段。</div>
                </li>
            </ul>
        </div>
    </main>
    
    <script>
        // 初始化mermaid，调整配置以更好显示复杂关系图
        mermaid.initialize({
            theme: document.body.classList.contains('dark-theme') ? 'dark' : 'default',
            securityLevel: 'loose',
            startOnLoad: true,
            er: {
                diagramPadding: 20,
                layoutDirection: 'TB',
                minEntityWidth: 100,
                minEntityHeight: 75,
                entityPadding: 15,
                stroke: '#d1d1d6',
                fill: '#ffffff',
                fontSize: 12,
                useMaxWidth: true
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
        
        // 主题切换功能
        document.querySelector('.toolbar-btn[title="切换主题"]').addEventListener('click', function() {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            this.querySelector('i').classList.toggle('fa-moon', !isDark);
            this.querySelector('i').classList.toggle('fa-sun', isDark);
            
            // 重新渲染mermaid图表以适应主题
            mermaid.initialize({
                theme: isDark ? 'dark' : 'default'
            });
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));
        });
        
        // 数据库数据 - 将在第二部分添加
    </script>
</body>
</html> 