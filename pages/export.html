<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>批量导出 - CreativePro Studio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #007AFF;
            --primary-blue-light: #E5F1FF;
            --success-green: #34C759;
            --warning-orange: #FF9500;
            --danger-red: #FF3B30;
            --gray-50: #F9FAFB;
            --gray-100: #F2F2F7;
            --gray-200: #E5E5EA;
            --gray-300: #D1D1D6;
            --gray-400: #C7C7CC;
            --gray-500: #AEAEB2;
            --gray-600: #8E8E93;
            --gray-700: #636366;
            --gray-800: #3A3A3C;
            --gray-900: #1C1C1E;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
            background-color: var(--gray-100);
            color: var(--gray-900);
            margin: 0;
            padding: 0;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Header Styles */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            margin: 0;
            letter-spacing: -0.02em;
        }

        .page-description {
            font-size: 15px;
            color: var(--gray-600);
            margin: 4px 0 0 0;
            max-width: 600px;
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background-color: #0062CC;
        }

        .btn-secondary {
            background-color: white;
            color: var(--primary-blue);
            border: 1px solid var(--gray-200);
        }

        .btn-secondary:hover {
            background-color: var(--gray-50);
        }

        /* Card Styles */
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 24px;
        }

        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 17px;
            font-weight: 600;
            margin: 0;
        }

        .card-header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-body {
            padding: 20px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--gray-800);
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-300);
            border-radius: 10px;
            font-size: 15px;
            transition: border-color 0.2s;
            background-color: white;
        }

        .form-control:focus {
            border-color: var(--primary-blue);
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%238E8E93' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        /* Checkbox Styles */
        .checkbox-group {
            margin-bottom: 12px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .checkbox-input {
            position: relative;
            width: 20px;
            height: 20px;
            margin-right: 10px;
            accent-color: var(--primary-blue);
        }

        .checkbox-label {
            font-size: 15px;
            color: var(--gray-800);
        }

        /* Radio Button Styles */
        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .radio-container {
            display: flex;
            align-items: center;
        }

        .radio-input {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            accent-color: var(--primary-blue);
        }

        .radio-label {
            font-size: 15px;
            color: var(--gray-800);
        }

        /* Export Options Grid */
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 16px;
        }

        .export-option-card {
            border: 1px solid var(--gray-200);
            border-radius: 10px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
        }

        .export-option-card:hover {
            border-color: var(--primary-blue);
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.1);
        }

        .export-option-card.selected {
            border-color: var(--primary-blue);
            background-color: var(--primary-blue-light);
        }

        .export-option-icon {
            font-size: 24px;
            color: var(--primary-blue);
            margin-bottom: 12px;
        }

        .export-option-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .export-option-description {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 12px;
        }

        .export-option-meta {
            font-size: 13px;
            color: var(--gray-500);
            margin-top: auto;
        }

        /* Footer Actions */
        .footer-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--gray-200);
        }

        /* Progress Bar */
        .progress-container {
            margin-bottom: 24px;
        }

        .progress-bar {
            height: 6px;
            background-color: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-blue);
            border-radius: 3px;
            width: 0;
            transition: width 0.3s ease;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }

        .progress-text {
            font-size: 14px;
            color: var(--gray-600);
        }

        /* 预设功能样式 */
        .presets-dropdown {
            position: relative;
        }

        .presets-button {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 8px;
            background-color: var(--gray-100);
            color: var(--gray-700);
            font-size: 14px;
            border: 1px solid var(--gray-300);
            cursor: pointer;
            transition: all 0.2s;
        }

        .presets-button:hover {
            background-color: var(--gray-200);
        }

        .presets-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            min-width: 220px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid var(--gray-200);
            z-index: 10;
            opacity: 0;
            transform: translateY(-10px);
            pointer-events: none;
            transition: all 0.2s;
        }

        .presets-menu.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .presets-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--gray-200);
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-800);
        }

        .presets-list {
            max-height: 240px;
            overflow-y: auto;
        }

        .preset-item {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .preset-item:hover {
            background-color: var(--gray-50);
        }

        .preset-item-icon {
            color: var(--primary-blue);
            margin-right: 12px;
            font-size: 16px;
        }

        .preset-item-content {
            flex: 1;
        }

        .preset-item-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-800);
            margin-bottom: 2px;
        }

        .preset-item-desc {
            font-size: 12px;
            color: var(--gray-600);
        }

        .presets-footer {
            padding: 12px 16px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
        }

        .preset-save-form {
            display: none;
            padding: 12px 16px;
            border-top: 1px solid var(--gray-200);
        }

        .preset-save-form.active {
            display: block;
        }

        .preset-save-form input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .preset-save-form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .preset-save-btn, .preset-cancel-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .preset-save-btn {
            background-color: var(--primary-blue);
            color: white;
        }

        .preset-save-btn:hover {
            background-color: #0062CC;
        }

        .preset-cancel-btn {
            background-color: var(--gray-100);
            color: var(--gray-700);
        }

        .preset-cancel-btn:hover {
            background-color: var(--gray-200);
        }

        .preset-remove-btn {
            color: var(--gray-500);
            padding: 4px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .preset-remove-btn:hover {
            color: #FF3B30;
            background-color: rgba(255, 59, 48, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <div>
                <h1 class="page-title">批量导出</h1>
                <p class="page-description">将批量项目导出为多种格式，满足各种发布和分享需求</p>
            </div>
            <button class="btn btn-secondary" onclick="window.history.back()">
                <i class="fas fa-arrow-left"></i> 返回
            </button>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">导出设置</h2>
                <div class="card-header-actions">
                    <div class="presets-dropdown" id="presetsDropdown">
                        <button class="presets-button" id="presetsButton">
                            <i class="fas fa-star"></i> 预设模板
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="presets-menu" id="presetsMenu">
                            <div class="presets-header">导出预设模板</div>
                            <div class="presets-list" id="presetsList">
                                <!-- 预设列表将通过JavaScript动态生成 -->
                            </div>
                            <div class="preset-save-form" id="presetSaveForm">
                                <input type="text" id="presetName" placeholder="预设名称" maxlength="30">
                                <div class="preset-save-form-actions">
                                    <button class="preset-cancel-btn" id="presetCancelBtn">取消</button>
                                    <button class="preset-save-btn" id="presetConfirmBtn">保存</button>
                                </div>
                            </div>
                            <div class="presets-footer">
                                <button class="btn btn-secondary btn-sm" id="savePresetBtn">
                                    <i class="fas fa-save"></i> 保存当前设置
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label class="form-label">项目选择</label>
                    <select class="form-control form-select">
                        <option>产品图像更新批量项目 (42张图片)</option>
                        <option>夏季促销活动设计 (18张图片)</option>
                        <option>新品展示图库 (35张图片)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">导出格式</label>
                    <div class="export-options">
                        <div class="export-option-card selected">
                            <div class="export-option-icon">
                                <i class="fas fa-file-image"></i>
                            </div>
                            <div class="export-option-title">图片文件</div>
                            <div class="export-option-description">将所有项目导出为独立图片文件</div>
                            <div class="export-option-meta">支持格式: JPG, PNG, WEBP</div>
                        </div>
                        
                        <div class="export-option-card">
                            <div class="export-option-icon">
                                <i class="fas fa-file-archive"></i>
                            </div>
                            <div class="export-option-title">压缩包</div>
                            <div class="export-option-description">将所有图片打包为一个压缩文件</div>
                            <div class="export-option-meta">支持格式: ZIP, RAR</div>
                        </div>
                        
                        <div class="export-option-card">
                            <div class="export-option-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="export-option-title">PDF文档</div>
                            <div class="export-option-description">将所有图片整合为一个PDF文档</div>
                            <div class="export-option-meta">适合打印和文档分享</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">图片格式设置</label>
                    <div class="radio-group">
                        <div class="radio-container">
                            <input type="radio" id="format-jpg" name="format" class="radio-input" checked>
                            <label for="format-jpg" class="radio-label">JPG</label>
                        </div>
                        <div class="radio-container">
                            <input type="radio" id="format-png" name="format" class="radio-input">
                            <label for="format-png" class="radio-label">PNG</label>
                        </div>
                        <div class="radio-container">
                            <input type="radio" id="format-webp" name="format" class="radio-input">
                            <label for="format-webp" class="radio-label">WEBP</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">图片质量</label>
                    <input type="range" class="form-control" min="1" max="100" value="90">
                </div>

                <div class="form-group">
                    <label class="form-label">图片大小</label>
                    <select class="form-control form-select">
                        <option>原始尺寸</option>
                        <option>1920 x 1080 px (16:9)</option>
                        <option>1080 x 1080 px (1:1)</option>
                        <option>1080 x 1350 px (4:5)</option>
                        <option>自定义尺寸...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">其他选项</label>
                    <div class="checkbox-group">
                        <div class="checkbox-container">
                            <input type="checkbox" id="option-metadata" class="checkbox-input" checked>
                            <label for="option-metadata" class="checkbox-label">保留元数据</label>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" id="option-watermark" class="checkbox-input">
                            <label for="option-watermark" class="checkbox-label">添加水印</label>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" id="option-rename" class="checkbox-input" checked>
                            <label for="option-rename" class="checkbox-label">使用序列名称</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">导出位置</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="form-control" placeholder="/Users/username/Documents/exports" style="flex: 1;">
                        <button class="btn btn-secondary" style="flex-shrink: 0;">
                            <i class="fas fa-folder-open"></i> 浏览
                        </button>
                    </div>
                </div>

                <div class="footer-actions">
                    <button class="btn btn-secondary">取消</button>
                    <button class="btn btn-primary" id="startExport">开始导出</button>
                </div>
            </div>
        </div>

        <!-- 导出进度卡片，默认隐藏 -->
        <div class="card" id="progressCard" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">导出进度</h2>
            </div>
            <div class="card-body">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-labels">
                        <span class="progress-text" id="progressText">处理中: 0/42</span>
                        <span class="progress-text" id="progressPercent">0%</span>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 24px;">
                    <span id="processingMessage">
                        <i class="fas fa-spinner fa-spin" style="color: var(--primary-blue); margin-right: 8px;"></i>
                        正在导出图片，请稍候...
                    </span>
                    <span id="completeMessage" style="display: none; color: var(--success-green);">
                        <i class="fas fa-check-circle" style="margin-right: 8px;"></i>
                        导出完成！共导出42张图片
                    </span>
                </div>
                
                <div class="footer-actions">
                    <button class="btn btn-secondary" id="cancelExport">取消</button>
                    <button class="btn btn-primary" id="viewResults" style="display: none;">
                        <i class="fas fa-folder-open"></i> 查看文件
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 预设功能相关元素
            const presetsButton = document.getElementById('presetsButton');
            const presetsMenu = document.getElementById('presetsMenu');
            const presetsList = document.getElementById('presetsList');
            const savePresetBtn = document.getElementById('savePresetBtn');
            const presetSaveForm = document.getElementById('presetSaveForm');
            const presetCancelBtn = document.getElementById('presetCancelBtn');
            const presetConfirmBtn = document.getElementById('presetConfirmBtn');
            const presetNameInput = document.getElementById('presetName');
            
            // 从localStorage获取导出预设
            let exportPresets = JSON.parse(localStorage.getItem('exportPresets') || '[]');
            
            // 更新预设列表
            function updatePresetsList() {
                presetsList.innerHTML = '';
                
                if (exportPresets.length === 0) {
                    const emptyItem = document.createElement('div');
                    emptyItem.className = 'preset-item';
                    emptyItem.innerHTML = `
                        <div class="preset-item-content">
                            <div class="preset-item-title" style="color: var(--gray-500);">暂无保存的预设</div>
                        </div>
                    `;
                    presetsList.appendChild(emptyItem);
                    return;
                }
                
                exportPresets.forEach((preset, index) => {
                    const presetItem = document.createElement('div');
                    presetItem.className = 'preset-item';
                    presetItem.setAttribute('data-index', index);
                    
                    // 创建预设项
                    presetItem.innerHTML = `
                        <div class="preset-item-icon">
                            <i class="fas fa-sliders-h"></i>
                        </div>
                        <div class="preset-item-content">
                            <div class="preset-item-title">${preset.name}</div>
                            <div class="preset-item-desc">${preset.formatName} · ${preset.quality}% · ${preset.sizeName}</div>
                        </div>
                        <div class="preset-remove-btn" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </div>
                    `;
                    
                    presetsList.appendChild(presetItem);
                    
                    // 点击预设项应用设置
                    presetItem.addEventListener('click', (e) => {
                        if (!e.target.closest('.preset-remove-btn')) {
                            applyPreset(preset);
                            presetsMenu.classList.remove('active');
                            
                            // 显示应用预设的通知
                            showNotification(`已应用预设：${preset.name}`, 'success');
                        }
                    });
                });
                
                // 为删除按钮添加事件
                document.querySelectorAll('.preset-remove-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const index = parseInt(btn.getAttribute('data-index'));
                        removePreset(index);
                    });
                });
            }
            
            // 应用预设
            function applyPreset(preset) {
                // 设置格式
                const formatRadios = document.querySelectorAll('input[name="format"]');
                formatRadios.forEach(radio => {
                    radio.checked = radio.id === `format-${preset.format}`;
                });
                
                // 设置质量
                const qualityRange = document.querySelector('input[type="range"]');
                qualityRange.value = preset.quality;
                
                // 设置大小
                const sizeSelect = document.querySelector('.form-group:nth-child(5) select');
                const sizeOptions = sizeSelect.querySelectorAll('option');
                sizeOptions.forEach(option => {
                    if (option.textContent === preset.sizeName) {
                        option.selected = true;
                    }
                });
                
                // 设置其他选项
                document.getElementById('option-metadata').checked = preset.metadata;
                document.getElementById('option-watermark').checked = preset.watermark;
                document.getElementById('option-rename').checked = preset.rename;
            }
            
            // 获取当前设置
            function getCurrentSettings() {
                // 获取选择的格式
                const selectedFormat = document.querySelector('input[name="format"]:checked');
                const format = selectedFormat.id.replace('format-', '');
                const formatName = selectedFormat.nextElementSibling.textContent;
                
                // 获取质量
                const quality = document.querySelector('input[type="range"]').value;
                
                // 获取大小
                const sizeSelect = document.querySelector('.form-group:nth-child(5) select');
                const sizeName = sizeSelect.options[sizeSelect.selectedIndex].textContent;
                
                // 获取其他选项
                const metadata = document.getElementById('option-metadata').checked;
                const watermark = document.getElementById('option-watermark').checked;
                const rename = document.getElementById('option-rename').checked;
                
                return {
                    format,
                    formatName,
                    quality,
                    sizeName,
                    metadata,
                    watermark,
                    rename
                };
            }
            
            // 保存预设
            function savePreset(name) {
                const settings = getCurrentSettings();
                settings.name = name;
                
                exportPresets.push(settings);
                localStorage.setItem('exportPresets', JSON.stringify(exportPresets));
                
                updatePresetsList();
            }
            
            // 删除预设
            function removePreset(index) {
                exportPresets.splice(index, 1);
                localStorage.setItem('exportPresets', JSON.stringify(exportPresets));
                
                updatePresetsList();
                showNotification('预设已删除', 'info');
            }
            
            // 显示通知
            function showNotification(message, type = 'info') {
                // 创建通知元素
                const notification = document.createElement('div');
                notification.className = 'preset-notification';
                
                let icon = 'info-circle';
                let color = 'var(--primary-blue)';
                
                if (type === 'success') {
                    icon = 'check-circle';
                    color = 'var(--success-green)';
                } else if (type === 'error') {
                    icon = 'exclamation-circle';
                    color = 'var(--danger-red)';
                }
                
                notification.innerHTML = `
                    <div class="notification-icon" style="color: ${color}">
                        <i class="fas fa-${icon}"></i>
                    </div>
                    <div class="notification-content">
                        ${message}
                    </div>
                `;
                
                // 添加样式
                const style = document.createElement('style');
                style.textContent = `
                    .preset-notification {
                        position: fixed;
                        top: 24px;
                        right: 24px;
                        background-color: white;
                        border-radius: 10px;
                        padding: 12px 16px;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        z-index: 1000;
                        transform: translateX(120%);
                        transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
                        border-left: 4px solid ${color};
                    }
                    .preset-notification.active {
                        transform: translateX(0);
                    }
                    .notification-icon {
                        font-size: 18px;
                    }
                    .notification-content {
                        font-size: 14px;
                        color: var(--gray-800);
                    }
                `;
                
                // 添加到文档
                document.head.appendChild(style);
                document.body.appendChild(notification);
                
                // 显示通知
                setTimeout(() => {
                    notification.classList.add('active');
                }, 10);
                
                // 3秒后隐藏
                setTimeout(() => {
                    notification.classList.remove('active');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 3000);
            }
            
            // 初始化预设列表
            updatePresetsList();
            
            // 预设按钮点击事件
            presetsButton.addEventListener('click', () => {
                presetsMenu.classList.toggle('active');
            });
            
            // 点击外部关闭预设菜单
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#presetsDropdown')) {
                    presetsMenu.classList.remove('active');
                    presetSaveForm.classList.remove('active');
                }
            });
            
            // 保存当前设置按钮点击事件
            savePresetBtn.addEventListener('click', () => {
                presetSaveForm.classList.add('active');
                presetNameInput.focus();
            });
            
            // 取消保存预设
            presetCancelBtn.addEventListener('click', () => {
                presetSaveForm.classList.remove('active');
                presetNameInput.value = '';
            });
            
            // 确认保存预设
            presetConfirmBtn.addEventListener('click', () => {
                const presetName = presetNameInput.value.trim();
                
                if (presetName === '') {
                    showNotification('请输入预设名称', 'error');
                    return;
                }
                
                // 检查预设名称是否已存在
                const existingPreset = exportPresets.find(preset => preset.name === presetName);
                if (existingPreset) {
                    showNotification('预设名称已存在', 'error');
                    return;
                }
                
                savePreset(presetName);
                presetSaveForm.classList.remove('active');
                presetNameInput.value = '';
                
                // 显示成功通知
                showNotification('预设保存成功', 'success');
            });
            
            // 回车键保存预设
            presetNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    presetConfirmBtn.click();
                }
            });
            
            // 从localStorage获取导出项目数据
            const exportProjects = JSON.parse(localStorage.getItem('exportProjects') || '[]');
            const projectSelect = document.querySelector('.form-group:first-child select');
            
            // 如果有传递的项目，则更新项目选择下拉框
            if (exportProjects.length > 0) {
                // 清空原有选项
                projectSelect.innerHTML = '';
                
                // 添加传递过来的项目
                exportProjects.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project.id;
                    option.textContent = `${project.name} (${project.imagesCount}张图片)`;
                    option.selected = true; // 默认选中第一个
                    projectSelect.appendChild(option);
                });
                
                // 更新项目数量和进度显示
                const totalItems = parseInt(exportProjects[0].imagesCount);
                const progressText = document.getElementById('progressText');
                progressText.textContent = `处理中: 0/${totalItems}`;
                
                // 添加数据传递通知
                showDataTransferNotification(exportProjects.length);
            }
            
            // 选择导出选项卡片
            const optionCards = document.querySelectorAll('.export-option-card');
            optionCards.forEach(card => {
                card.addEventListener('click', function() {
                    optionCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // 开始导出按钮点击事件
            const startExportBtn = document.getElementById('startExport');
            const progressCard = document.getElementById('progressCard');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const progressPercent = document.getElementById('progressPercent');
            const processingMessage = document.getElementById('processingMessage');
            const completeMessage = document.getElementById('completeMessage');
            const viewResultsBtn = document.getElementById('viewResults');
            
            startExportBtn.addEventListener('click', function() {
                // 获取选中项目的图片数量
                const selectedOption = projectSelect.options[projectSelect.selectedIndex];
                const itemCountMatch = selectedOption.textContent.match(/\((\d+)张图片\)/);
                const totalItems = itemCountMatch ? parseInt(itemCountMatch[1]) : 42;
                
                // 显示进度卡片
                progressCard.style.display = 'block';
                
                // 更新进度文本
                progressText.textContent = `处理中: 0/${totalItems}`;
                
                // 模拟进度更新
                let progress = 0;
                
                const interval = setInterval(() => {
                    progress += 1;
                    const percent = Math.round((progress / totalItems) * 100);
                    
                    progressFill.style.width = `${percent}%`;
                    progressText.textContent = `处理中: ${progress}/${totalItems}`;
                    progressPercent.textContent = `${percent}%`;
                    
                    if (progress >= totalItems) {
                        clearInterval(interval);
                        processingMessage.style.display = 'none';
                        completeMessage.style.display = 'inline';
                        completeMessage.innerHTML = `<i class="fas fa-check-circle" style="margin-right: 8px;"></i>导出完成！共导出${totalItems}张图片`;
                        viewResultsBtn.style.display = 'block';
                    }
                }, 100);
            });
            
            // 取消导出按钮
            const cancelExportBtn = document.getElementById('cancelExport');
            cancelExportBtn.addEventListener('click', function() {
                progressCard.style.display = 'none';
            });
            
            // 查看结果按钮
            viewResultsBtn.addEventListener('click', function() {
                alert('在文件管理器中打开导出文件夹');
            });
            
            // 显示数据传递通知
            function showDataTransferNotification(projectCount) {
                // 创建通知元素
                const notification = document.createElement('div');
                notification.className = 'data-transfer-notification';
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">已接收${projectCount}个项目</div>
                        <div class="notification-desc">从批量处理中心传入</div>
                    </div>
                `;
                
                // 添加样式
                const style = document.createElement('style');
                style.textContent = `
                    .data-transfer-notification {
                        position: fixed;
                        top: 24px;
                        left: 50%;
                        transform: translateX(-50%) translateY(-100px);
                        background-color: var(--gray-800);
                        color: white;
                        border-radius: 10px;
                        padding: 16px;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                        z-index: 1000;
                        opacity: 0;
                        transition: all 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
                    }
                    .data-transfer-notification.active {
                        transform: translateX(-50%) translateY(0);
                        opacity: 1;
                    }
                    .notification-icon {
                        background-color: var(--primary-blue-light);
                        color: var(--primary-blue);
                        width: 36px;
                        height: 36px;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 16px;
                    }
                    .notification-title {
                        font-weight: 600;
                        margin-bottom: 4px;
                    }
                    .notification-desc {
                        font-size: 13px;
                        color: var(--gray-300);
                    }
                `;
                
                // 添加到文档
                document.head.appendChild(style);
                document.body.appendChild(notification);
                
                // 显示通知
                setTimeout(() => {
                    notification.classList.add('active');
                }, 300);
                
                // 3秒后隐藏
                setTimeout(() => {
                    notification.classList.remove('active');
                    setTimeout(() => {
                        notification.remove();
                    }, 400);
                }, 3000);
            }
        });
    </script>
</body>
</html> 